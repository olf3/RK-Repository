'/////////////////////////////////////////////////////////////////////////////////////////
'//VBSCRIPT VERSION:        STD_VBS_WORD_08292003_V2 (PLEASE DO NOT CHANGE!!!)          //
'//Public Folder:           CONFIRMATION                                                //
'//Outlook Form:            STD_Swap_Confirmation.oft                                   //
'//Word Document Template:  STD_IRS_Confirmation.doc                                    //
'// 				    STD_CS_Confirmation.doc                                     //
'//AVS Script File Name:    STD_Swap_Confirm.mls                                        //
'//Author:                  Donald Chan                                                 //
'//Last Update:             Dec 4, 2003                                                 //
'//Description/Note:        This form is created in Outlook 2000 with Exchange 2000     //
'/////////////////////////////////////////////////////////////////////////////////////////
'----------------------------------------------------------------------------------------
'----------------------------------------------------------------------------------------

Dim objDoc
Dim objApp

'-----------------------------------------------------------------------------------------
'/////////////////////////////////////////////////////////////////////////////////////////
'Name:          Item_Open()
'
'Description:   This Microsoft-defined function is called when an item is being open.
'               It opens a Word document and populates the data from the Message
'               store.
'
'Parameters:    NONE
'
'Returns:       TRUE    -   if the item was opened successfully
'               FALSE   -   if any errors occurred.  Microsoft uses the return
'               code to determine open action
'
'Date of Last Revisition: Feb 22, 2002
'/////////////////////////////////////////////////////////////////////////////////////////
Function Item_Open()
    
    Call FORM_Initialize("P.2")

' stop
    
    If DOC_Open(objApp, objDoc) = False Then
        Exit Function
    End If

    Call DOC_SetConditionalData(objDoc)

    Item_Open = True
    'objApp.Run "Doc_Protect"
End Function

'--------------------------------------------------------------------------------------------
'///////////////////////////////////////////////////////////////////////////////////////////
'Name:          Item_Close()
'
'Description:   This Microsoft-defined function is called when an item is being closed.
'               It calls DOC_Close function to close Word document and its application object.
'
'Parameters:    NONE
'
'Returns:       Status of DOC_Close() - TRUE / FALSE
'               TRUE    -   if the item was closed successfully
'               FALSE   -   if any errors occurred.  Microsoft uses the return
'                           code to determine close action
'
'Date of Last Revisition:   AUG 29, 2002
'/////////////////////////////////////////////////////////////////////////////////////////////
Function Item_Close()
    Item_Close = DOC_Close(objApp, objDoc)
End Function


'--------------------------------------------------------------------------------------------
'///////////////////////////////////////////////////////////////////////////////////////////
'Name:          Item_Forward()
'
'Description:   Override Microsoft-defined function Item_Forward() to print Word Document.
'
'Parameters:    NONE
'
'Returns:       Default value
'               NOTE: This function must return the default value.
'                     Do not try to set Item_Forward to any value!
'
'
'Date of Last Revisition:   AUG 29, 2002
'////////////////////////////////////////////////////////////////////////////////////////////
Function Item_Forward(ByVal myForWardItem)
   on error Resume Next
   Err.Clear

   '//set printer
   Dim strPrinterName
   Dim strPrinterPort
   Dim strActivePrinter

   strPrinterName = OLF_GetField("olfPrinterName")
   strPrinterName = Trim(strPrinterName)
   strPrinterPort = OLF_GetField("olfPrinterPort")
   strPrinterPort = Trim(strPrinterPort)

   If strPrinterName <> "" And strPrinterPort <> "" Then
    strActivePrinter = strPrinterName & " on " & strPrinterPort & ":"
    objApp.ActivePrinter = strActivePrinter
   End If
 
   '//print out document
    objDoc.PrintOut
End Function 


'---------------------------------------------------------------------------------------------
'///////////////////////////////////////////////////////////////////////////////////////////
'Name:          cmdClose_Click()
'
'Description:   Close Word document and outlook form and exit program,
'               and prompts the user for saving changes.
'
'Parameters:    NONE
'
'Returns:       NONE
'
'Date of Last Revisition:   Feb 22, 2002
'/////////////////////////////////////////////////////////////////////////////////////////////
Sub cmdClose_Click()
    Const olPromptForSave = 2
      Item.Close olPromptForSave
End Sub




'---------------------------------------------------------------------------------------
'////////////////////////////////////////////////////////////////////////////////////////
'Name:          DOC_Open(ByRef objApplication, ByRef objDocument )
'
'Description:   This function opens a Word document and populates the
'               data from the Message store
'
'Parameters:    objApplication  (OUT)   - an instance of the Application object
'               objDocument (OUT)       - an instance of the Word Document object
'
'Returns:       TRUE    -   if the data was successfully populated on the
'                           Word document and no errors occurred
'               FALSE   -   if any errors occurred
'
'Date of Last Revisition:   Feb 22, 2002
'//////////////////////////////////////////////////////////////////////////////////////
Function DOC_Open(ByRef objApplication, ByRef objDocument)

    on error Resume Next
    Err.Clear

    '//Create Word Application and Document Objects.
    If DOC_CreateWordObjects(objApplication, objDocument) = False Then
        DOC_Open = False
        Exit Function
    End If
    
    '//Set Visible to false until all fields are populated.
    '//This makes a pop-up result
    Call DOC_SetVisible(objApplication, False)
 
    '//set Word properties:
    Call DOC_SetProperties(objApplication, objDocument)

    '//Set Confirmation/Documentation Status
    If DOC_SetStatus(objDocument) = False Then
        MsgBox "Unable to set Status in Word document file " & OLF_GetField("olfFileNameWithPath"), _
             vbCritical, _
             "Error"
    End If

    '//Populate all data to Word document
    Call DOC_AutoPopulateData(objDocument)

    '//Ajout de l'adresse en pied de page JML, le 24/06/2008
    Call DOC_Adresse(objApplication,objDocument)
    
    '//Turn this function on for debugging, otherwise off
    'Call OnErrorShowMessage()

    '//Now that the fields are populated, show the Word document
    Call DOC_SetVisible(objApplication, True)
 
    DOC_Open = True
End Function
'----------------------------------------------------------------------------------------
'////////////////////////////////////////////////////////////////////////////////////////
'Name:          DOC_CreateWordObjects(ByRef objWordApplication, ByRef objWordDocument)
'
'Description:   This function creates an Application object and a Word document object.
'               NOTICE: If it fails to create either one of these objects,
'               Word document cannot be run.
'
'Parameters:    objWordApplication  (IN/OUT)   - an instance of the Application object
'               objWordDocument (IN/OUT)   - an instance of the Word Document object
'
'Returns:       TRUE    -   if both objects are sucessfully created with no errors.
'               FALSE   -   if failed to create either object or any errors occurrs.
'
'Date of Last Revisition:   Feb 25, 2002
'//////////////////////////////////////////////////////////////////////////////////////
Function DOC_CreateWordObjects(ByRef objWordApplication, ByRef objWordDocument)

    on error Resume Next
    Err.Clear

    Dim objWordApp

    '//Create instance of Word Application Object
    Set objWordApp = CreateObject("Word.Application")

    '//Exit if unable to create word Application object.
    If objWordApp Is Nothing Then
        MsgBox "Couldn't start Word.", vbCritical, "Error"
        DOC_CreateWordObjects = False
        Exit Function
    End If

    '//Open a new document
    Dim objWordDoc
    
    Dim strDocumentFileNameWithFullPath
    strDocumentFileNameWithFullPath = OLF_GetField("olfFileNameWithPath")
    strDocumentFileNameWithFullPath = Trim(strDocumentFileNameWithFullPath)

    If strDocumentFileNameWithFullPath <> "" And strDocumentFileNameWithFullPath <> "-" Then
        Set objWordDoc = objWordApp.Documents.Add(strDocumentFileNameWithFullPath)
    End If

    If objWordDoc Is Nothing Then
        If strDocumentFileNameWithFullPath = "" Then
            If IsExit(objWordApp) = True Then
                objWordApp.Quit
            End If
        End If
        
        Call Object_Destroy(objWordApp)

        MsgBox "The Word document file " & strDocumentFileNameWithFullPath & _
                 " not found!", _
                vbCritical, _
                "Couldn't start Word."
        DOC_CreateWordObjects = False
        Exit Function '//Exit if unable to create word document object.
    End If
    
    '//Turn this function on for debugging, otherwise turn it off
    'Call OnErrorShowMessage()

    '//point objWordDoc (document object) to objDocc
    Set objWordDocument = objWordDoc

    '//Set oApp point to objWordApp
    Set objWordApplication = objWordApp
    
    DOC_CreateWordObjects = True
    
End Function
'----------------------------------------------------------------------------------------

'----------------------------------------------------------------------------------------
'////////////////////////////////////////////////////////////////////////////////////////
'Name:          DOC_SetVisible(ByRef objWordApplication, ByRef blnTrueFalse)
'
'Description:   This function sets the visibility of the Word document to True of False,
'           depending on blnTrueFalse.
'
'Parameters:    objWordApplication  (IN)   - the Word Application object
'               blnTrueFalse (IN)          -  True or False
'
'Returns:       NONE
'
'Date of Last Revisition:   Feb 25, 2002
'//////////////////////////////////////////////////////////////////////////////////////
Sub DOC_SetVisible(ByRef objWordApplication, ByRef blnTrueFalse)
    '//set Visible to false until all fields are populated.
    objWordApplication.Visible = blnTrueFalse
End Sub



'----------------------------------------------------------------------------------------
'////////////////////////////////////////////////////////////////////////////////////////
'Name:          DOC_AutoPopulateData(ByRef objDocument)
'
'Description:   This function automatically populate all data to Word document
'
'Parameters:    objDocument  (IN)   - the Word Document object
'
'Returns:       NONE
'
'Date of Last Revisition:   Feb 25, 2002
'//////////////////////////////////////////////////////////////////////////////////////
Sub DOC_AutoPopulateData(ByRef objDocument)
    on error resume next

    '//if object objDocument doesn't exist, exit.
    '//else point objAutoDoc to objDocument
    If IsExist(objDocument) = True Then
        Dim objAutoDoc
        Set objAutoDoc = objDocument
    Else
        MsgBox "Unable to populate data into Word document because " & _
                "the Word Document object does not exist.", _
                vbCritical, "Error: object not exist"
        Exit Sub
    End If

    '//If the form contains user-defined fields,
    '//transfer the contents of user-defined field( FieldName) to Word:
    Dim intTotalFields
    Dim strDocFieldName
    Dim strOlfFieldName
    Dim strFieldValue
    Dim intFound
    Dim i

    intTotalFields = objAutoDoc.FormFields.Count
    For i = 1 To intTotalFields
        strDocFieldName = ""
        strDocFieldName = objAutoDoc.FormFields.Item(i).Name
	  

        If (strDocFieldName <> "") And (strDocFieldName <> "olfConfStatus") Then
            intFound = InStr(1, strDocFieldName, "_")

            If intFound <> 0 Then
                strOlfFieldName = Left(strDocFieldName, intFound - 1)
		Else
                strOlfFieldName = strDocFieldName
            End If

            strFieldValue = ""
            strFieldValue = Item.UserProperties.Find(strOlfFieldName)

            If strFieldValue <> "" Then
                If InStr(1, strFieldValue, vbLf) <> 0 Then   '//find with listbox
                    strFieldValue = Replace(strFieldValue, vbLf, vbCr)
		    End If
                objAutoDoc.FormFields(strDocFieldName).Result = strFieldValue
            End If
        End If
    Next

End Sub

'----------------------------------------------------------------------------------------
'////////////////////////////////////////////////////////////////////////////////////////
'Name:          IsExist(ByRef varName)
'
'Description:   This function determines the variable and object status.
'
'Parameters:    varName (IN)   - variable name, such as an object or a datatype
'
'Returns:       True  - object exists
'               False - object does not exist
'
'Date of Last Revisition:   Feb 25, 2002
'//////////////////////////////////////////////////////////////////////////////////////
Function IsExist(ByRef varName)
    Dim strStatus
    strStatus = ""

    strStatus = TypeName(varName)
    Select Case LCase(strStatus)
        Case ""
            IsExist = False
        Case "empty"
            IsExist = False
        Case "nothing"
            IsExist = False
        Case "null"
            IsExist = False
        Case Else
            IsExist = True
    End Select
End Function


'----------------------------------------------------------------------------------------
'////////////////////////////////////////////////////////////////////////////////////////
'Name:          	(ByRef objApplication, ByRef objDocument)
'
'Description:   Set Word Document Properties.
'
'Parameters:    objApplication  (IN)   - the Word Application object.
'               objDocument     (IN)   - the Word Document object.
'
'Returns:       NONE
'
'Date of Last Revisition:   Sep 27, 2002
'//////////////////////////////////////////////////////////////////////////////////////
'----------------------------------------------------------------------------------------
Sub DOC_SetProperties(ByRef objApplication, ByRef objDocument)

    Dim strArgDate
    Dim strCflow 
    Dim strAgrtType
    Dim strPeriod 
    Dim strPeriod2
    Dim strPeriod3 
    Dim strMonoPeriod
    Dim strLegs
    Dim strFxFlt
    Dim strPayRec
    Dim flag
    Dim intMaxLong
    Dim xmldoc
    Dim xmlNode
    Dim xmlSubNode
    Dim strCte1 
    Dim strCte2
    'Begin_2.0
    Dim strConstante1
    'Dim strConstante3
    'Dim strCte3
    'End_2.0
    Dim strBarrier1
    Dim strReset
    Dim strTemplateDir
    Dim intFirstLeg
    Dim intFirstFmla
    Dim strExtInter 
    Dim strIntInter 
    Dim strPricingModel
    Dim strRstShift
    Dim strRstShift2
    Dim NumFxAmnt
    Dim NumFltAmnt
    Dim strIdx
    Dim strIdx2
    Dim strExtBU
    Dim strFlagDoc1
    Dim strFlagDoc2
    Dim strUnadA
    Dim strUnadB
    Dim intflagAdUnad 
    Dim strTerminationDate
    Dim strLblTermAdjDate
    Dim strLblTermNonAdjDate
    Dim strLastLeg
    Dim strLegUnad
    Dim NumFxNonAdjAmnt
    Dim NumFltNonAdjAmnt
    Dim NumFxAdjAmnt
    Dim NumFltAdjAmnt
    Dim intAllLegUnad 
    Dim strFxSeparateur
    Dim strFltSeparateur
    Dim strFxAdjSeparateur 
    Dim strFltAdjSeparateur

    'DCH dual
    Dim strProjIdx2
    Dim strDealNum
    'DCH Ref 61
    Dim StrFlagOpt

    intFirstLeg = 0
    intFirstFmla = 0
    intMaxLong = 254
    intflagAdUnad = 0
    intAllLegUnad = 0
    strFxSeparateur = ""
    strFltSeparateur = ""
    strFxAdjSeparateur = ""
    strFltAdjSeparateur = ""
    
    'Begin_2.0
    Dim Cd_rgpt_str
    Dim strMaxCoupon
    Dim strIndexMeans
    Dim strIndexMeans2
    Dim strPublishedOn
    Dim strPublishedOn2
    Dim strIndexTenorSansY
    Dim strIndexTenor2SansY
    Dim strDelPymt
    Dim strDelPymtIdx2
    Dim strDelPymtIdx3
    Dim strRstHolSchdIdx2ter
    Dim strRstHolSchd
    Dim strRstHolSchd2
    'End_2.0

    'Begin_ref59
    Dim strolfOptHolList
    Dim strolfOptHolList_1
    Dim strolfOptHolList_2
    Dim strolfOptExpTime
    Dim strolfOptFirstDelDate
    Dim strolfOptRollDate
    Dim strolfOptPymtPeriod
    Dim strolfTranMaturityDate
    Dim strolfPymtConv

    strolfOptHolList   = OLF_GetField("olfOptHolSchd")
    strolfOptHolList_1 = OLF_GetField("olfOptHolList")
    strolfOptHolList_2 = OLF_GetField("olfOptHolList")
    strolfOptExpTime   = OLF_GetField("olfOptExpTime")
    strolfOptStyle     = OLF_GetField("olfOptStyle")
    strolfOptDelPymt   = OLF_GetField("olfOptDelPymt")
    strolfOptDateOffset   = OLF_GetField("olfOptDateOffset")
    strolfOptFirstDelDate = OLF_GetField("olfOptFirstDelDate")
    strolfOptRollDate = OLF_GetField("olfOptRollDate")
    'strolfOptPymtPeriod = OLF_GetField("olfOptPymtPeriod")
    strolfTranMaturityDate = OLF_GetField("olfTranMaturityDate")
    strolfOptPymtConv = OLF_GetField("olfOptPymtConv")
    'End_ref59

    'Begin_ref22
    Dim strolfInsType
    Dim intFlagCtrlCSC
    Dim strolfMttFANotAmt
    Dim strolfMttFxNotAmt
    Dim strolfDevFANotAmt
    Dim strolfDevFxNotAmt
    Dim strCflowDateNI1
    Dim strolfCflowMntNI1
    Dim strCflowCcyNI1
    Dim strCflowPymtConvNI1
    Dim strolfCflowMntNI2
    Dim strCflowCcyNI2
    Dim strCflowPymtConvNI2
    Dim strCflowDateFI1
    Dim strolfCflowMntFI1
    Dim strCflowCcyFI1
    Dim strCflowPymtConvFI1
    Dim strolfCflowMntFI2
    Dim strCflowCcyFI2
    Dim strCflowPymtConvFI2
    Dim strNoneName
    Dim strolfNtlHolShd
    intFlag_soulte = 0	
    intFlagCtrlCSC = 0
    intFlag_exist_soulte = 1

    on error resume next

    strolfInsType = OLF_GetField("olfInsType")
    strIntBU = OLF_GetField("olfIntBULongName")

    'End_ref22

' JML le 22/20/7 on n'affiche pas le bloc d'amo
    If (OLF_GetField("olfAmort")<>"O") Then
		objDocument.Bookmarks("olfDelTabAmort").Select
		objApplication.Selection.Delete
		objApplication.Selection.TypeBackspace
            ' fin JML
    End If

'Begin_ref56 --DEK--
    Dim strFXFloaterSpd
    Dim strFXFloaterFx0
    Dim FlagLegFXDigit
    FlagLegFXDigit = 0	
'End_ref56

' Begin_ref51
    Dim strolfMinCoupon
    Dim strolfFltSpd	
    Dim strolfBarrierRate
    Dim strolfIdxName
    Dim strolfPublishTable
    Dim strolfRfiShift
    Dim strolfRfiShift2
    Dim strolfRFIS1CPI
    Dim strolfRFIS1
    Dim stroldEndDate1

' End_ref51


' JML, le 11/9/7 ajout MIFID

    Dim strFlMIFID
    Dim strAFB

    strAgrtType = OLF_GetField("olfAgrtType")
    strTemplateDir = OLF_GetField("olfTemplateDir")
    strFlMIFID=OLF_GetField("olfFlMIFID")    
    If (strFlMIFID="N") Then	  
	  Call DOC_HideSection(objApplication, "olfHideTTimeStart", "olfHideTTimeEnd")
    End If


' fin JML ajout MIFID

' Begin_ref49
    Dim strBuySell
    Dim strMatDate
    Dim strYldbasis
    Dim strIdxTenor
    Dim strResetConv
    Dim strHolSchd	
    Dim strRollDate
    Dim strFRollDate
    Dim strProjIndex
' End_ref49

' Seb
    
    Dim strReference
    strReference = OLF_GetField("olfReference")

    ' DCH Affichage du dealnum dans le pied de page
    strDealNum = OLF_GetField("olfDealNum")
    objDocument.Bookmarks("olfDealNum_2").Range.InsertAfter strDealNum

    ' DCH récupération du flag pour la présence de la jambe option
    StrFlagOpt = OLF_GetField("opt1")

    ' Begin_ref49
    ' DCH Récupération du BuySell	
    strBuySell = OLF_GetField("olfBuySell")
    ' End_ref49

    'Begin_2.0 récupération du code regroupement
    Cd_rgpt_str = OLF_GetField("olfCdRgpt")
    'End_2.0

'Djamal
    strArgDate = OLF_GetField("olfAgrtStartDate")
    strArgDate = Trim(strArgDate)
    strPricingModel =  OLF_GetField("olfPricingModel")
    strExtBU = OLF_GetField("olfExtBUShortName")
    strTemplateDir = OLF_GetField("olfTemplateDir")
    strUnadA = OLF_GetField("UnadA")
    strUnadB = OLF_GetField("UnadB")

    ' stop

    'flag pour gestion du cas deniere jambes ajustee/unajustee
    If (UCase(strUnadA) <> UCase(strUnadB)) Then
	  intflagAdUnad = 1
    End If
	
    '//gestion des contrats cadres
    'If (UCase(strPricingModel)= "FLEXI" And UCase(strExtBU)= "DPPFGB2LNSW" )Then
	'  Call DOC_HideSection(objApplication, "olfHideCtrt1START", "olfHideCtrt2END")
    'ElseIf (UCase(strArgDate) = "NOT AVAILABLE") Then
     '   Call DOC_HideSection(objApplication, "olfHideCtrt2START", "olfHideCtrt2END")
    'Else
	'  Call DOC_HideSection(objApplication, "olfHideCtrt1START", "olfHideCtrt1END")
    'End If

    '//gestion des soultes
    strCflow = OLF_GetField("olfCflow")
'Thomas - soultes multiples

    strAgrtType = OLF_GetField("olfAgrtType")
    Set xmldoc= CreateObject("MSXML2.DOMDocument")

    '//Exit if unable to create word Application object.
    If xmldoc Is Nothing Then
        MsgBox "Couldn't start xml.", vbCritical, "Error"
	  Exit Sub
    End If

    xmldoc.async = False
    xmldoc.resolveExternals = False
    xmldoc.validateOnParse = False

    xmldoc.loadXML(strCflow)


    ' stop
    'objDocument.Bookmarks("olfCashFlows").Select
    strIntLent = OLF_GetField("olfIntLentLngName")
    strExtBU = OLF_GetField("olfExtBULongName")
    strExtBUSht = OLF_GetField("olfExtBUShortName")
    'objApplication.Selection.Collapse wdCollapseStart
    'objApplication.Selection.MoveLeft (1)

    
    's'il n'y a pas de bloc dans le champ olfCflow, on met none
    'If (xmldoc.documentElement.HasChildNodes = False) Then
    '    objApplication.Selection.InsertFile strTemplateDir & strAgrtType & " Cash Flow.doc"
    '    objDocument.Bookmarks("olfDelForNone").Range.Text = ""
    '    objDocument.Bookmarks("olfNone").Range.Text = "None"
    'End If

    'Begin _ref49 Partie concernant les CAP ou FLOOR	
    For Each xmlNode In xmldoc.documentElement.childNodes
	'date
	strCflowDate = xmlNode.selectSingleNode("olfCflowDate").Text
      Call DOC_SetField(objDocument, "olfFRPPaymentDate",strCflowDate)
	
	'devise
	strCflowCcy = xmlNode.selectSingleNode("olfCflowCcy").Text
	Call DOC_SetField(objDocument, "olfFxCcy",strCflowCcy)

	'Montant
	strCflowMnt = xmlNode.selectSingleNode("olfCflowMnt").Text
	Call DOC_SetField(objDocument, "olfFxNotnl",StrCflowMnt)

	'strCflowPymtConv = xmlNode.selectSingleNode("olfCflowPymtConv").Text
	'objDocument.Bookmarks("olfCflowPymtConv").Range.Text = strCflowPymtConv
    Next
    ' End_ref49

    strIntInter = OLF_GetField("olfIntInterName")
    strExtInter = OLF_GetField("olfExtInterName")
    'If (strIntInter <= " ") Then
	'Call DOC_HideSection(objApplication, "olfHideFTAIntStart", "olfHideFTAIntEnd")
    'End If
    'If (strExtInter <= " ") Then
	'Call DOC_HideSection(objApplication, "olfHideFTAExtStart", "olfHideFTAExtEnd")
    'End If

   'Call DOC_HideFieldByPrefix(objApplication, "olfHide")

   strFlagDoc1 = OLF_GetField("olfFlagDoc1")

   if (strFlagDoc1 = "OUI") Then
	   strFlagDoc2 = OLF_GetField("olfFlagDoc2")
	   if (strFlagDoc2 > " ") Then
		objDocument.Bookmarks("customisation").Select
         	objApplication.Selection.Collapse wdCollapseStart
         	objApplication.Selection.MoveLeft (1)
         	objApplication.Selection.InsertFile strTemplateDir & strFlagDoc2
		If (Ucase(strPricingModel) <> "FLEXI" And Ucase(StrFlagOpt) <> "1") Then
			objDocument.Bookmarks("NumAccDet").Range.Text = "4"
			objDocument.Bookmarks("NumContDet").Range.Text = "5"
		Else
			objDocument.Bookmarks("NumAddProv").Range.Text = "4"
			objDocument.Bookmarks("NumAccDet").Range.Text = "5"
			objDocument.Bookmarks("NumContDet").Range.Text = "6"
		End If
         End If
   Else
            objDocument.Bookmarks("customisation").Select
         	objApplication.Selection.Collapse wdCollapseStart
         	objApplication.Selection.MoveLeft (1)
         	objApplication.Selection.InsertFile strTemplateDir & "Option_Disclaimer.doc"
		If (Ucase(strPricingModel) <> "FLEXI" And Ucase(StrFlagOpt) <> "1") Then
			objDocument.Bookmarks("NumAccDet").Range.Text = "4"
			objDocument.Bookmarks("NumContDet").Range.Text = "5"		
		Else
			objDocument.Bookmarks("NumAddProv").Range.Text = "4"
			objDocument.Bookmarks("NumAccDet").Range.Text = "5"
			objDocument.Bookmarks("NumContDet").Range.Text = "6"
		End If

   End If
'xml

    strAgrtType = OLF_GetField("olfAgrtType")
    strLegs = OLF_GetField("olfLegs")

    Set xmldoc= CreateObject("MSXML2.DOMDocument")

    '//Exit if unable to create word Application object.
    If xmldoc Is Nothing Then
        MsgBox "Couldn't start xml.", vbCritical, "Error"
	  Exit Sub
    End If

    xmldoc.async = False
    xmldoc.resolveExternals = False
    xmldoc.validateOnParse = False

    xmldoc.loadXML(strLegs)

    'On s'occupe des branches Pay en premier
    For Each xmlNode In xmldoc.documentElement.childNodes
    
      'objDocument.Bookmarks("jambes").Select

      'objApplication.Selection.Collapse wdCollapseStart
      'objApplication.Selection.MoveLeft (1)


	'branches Pay Float    
      For Each xmlSubNode In xmlNode.childNodes
        
        strPayRec = xmlNode.selectSingleNode("olfPayRec").Text
        strFxFlt = xmlNode.selectSingleNode("olfFxFlt").Text
    	  'strMonoPeriod = xmlNode.selectSingleNode("olfMonoPeriod").Text    
    	  strLastLeg = xmlNode.selectSingleNode("olfLastLeg").Text 
	  strLegUnad = xmlNode.selectSingleNode("olfLegUnad").Text
 	  intFlagCtrlCSC = 0

	  'Begin_ref49
	  If (Ucase(strBuySell) = "SELL" or Ucase(strBuySell) = "BUY") Then
		If (xmlSubNode.nodeName = "olfMaturityDate") Then
			strMatDate = xmlNode.selectSingleNode("olfMaturityDate").Text
            	Call DOC_SetField(objDocument, "olfMaturityDate",strMatDate)
		ElseIf (xmlSubNode.nodeName = "olfYldBasis") Then
			strYldbasis = xmlNode.selectSingleNode("olfYldBasis").Text
            	Call DOC_SetField(objDocument, "olfYldBasis",strYldbasis)
		ElseIf (xmlSubNode.nodeName = "olfIndexTenor") Then
			strIdxTenor = xmlNode.selectSingleNode("olfIndexTenor").Text
            	Call DOC_SetField(objDocument, "olfIndexTenor",strIdxTenor)
		ElseIf (xmlSubNode.nodeName = "olfResetConv") Then
			strResetConv = xmlNode.selectSingleNode("olfResetConv").Text
            	Call DOC_SetField(objDocument, "olfResetConv",strResetConv)
		ElseIf (xmlSubNode.nodeName = "olfHolSchd") Then
			strHolSchd = xmlNode.selectSingleNode("olfHolSchd").Text
            	Call DOC_SetField(objDocument, "olfHolschd",strHolSchd)
		ElseIf (xmlSubNode.nodeName = "olfRollDate") Then
			strRollDate = xmlNode.selectSingleNode("olfRollDate").Text
            	Call DOC_SetField(objDocument, "olfRollDate",strRollDate)
		ElseIf (xmlSubNode.nodeName = "olfFRollDate") Then
			strFRollDate = xmlNode.selectSingleNode("olfFRollDate").Text
            	Call DOC_SetField(objDocument, "olfFRollDate",strFRollDate)
		ElseIf (xmlSubNode.nodeName = "olfProjIndex") Then
			strProjIndex = xmlNode.selectSingleNode("olfProjIndex").Text
            	Call DOC_SetField(objDocument, "olfProjIndex",strProjIndex)
		End If
	  End IF
	  'End_ref49
 
        If (UCase(strPayRec) = "PAY" And UCase(strFxFlt) = "FLOAT") Then
		strIdx = xmlNode.selectSingleNode("olfProjIndex").Text
		strIdx2 = xmlNode.selectSingleNode("olfProjIndex2").Text
	      strPeriod = xmlNode.selectSingleNode("olfIndexTenor").Text
		strCte1 = xmlNode.selectSingleNode("olfConstante1").Text
            strCte2 = xmlNode.selectSingleNode("olfConstante2").Text
		'strCte3 = xmlNode.selectSingleNode("olfConstante3").Text
		strBarrier1 = xmlNode.selectSingleNode("olfBarrier1").Text
      	strRstShift = xmlNode.selectSingleNode("olfResetShift").Text
            strReset = xmlNode.selectSingleNode("olfReset").Text
            strPeriod2 = xmlNode.selectSingleNode("olfIndex2Tenor").Text
		
		strolfResetConv2 = xmlNode.selectSingleNode("olfResetConv2").Text

		'Dual

		strProjIdx2 = xmlNode.selectSingleNode("olfProjIndex2").Text
		If flag = 0 Then
'Thomas

		    If (strCte1 = "" Or strCte1 = " " ) Then
			'objApplication.Selection.InsertFile strTemplateDir & strAgrtType & " Variables IRS.doc"
			intFlagCtrlCSC = 1

		    ElseIf ((strCte1 = "" Or strCte1 = " "  ) And ( Ucase(strPricingModel) = "FLEXI" )) Then
			'objApplication.Selection.InsertFile strTemplateDir & strAgrtType & " Variables IRS.doc"
			intFlagCtrlCSC = 1

		    ElseIf ((strCte1 = "" Or strCte1 = " "  ) And (Ucase(strPricingModel) = "FXDIGIT" Or Ucase(strPricingModel) = "FXFLOATER")  And (strProjIdx2 = "" Or strProjIdx2 = " "  )) Then
			'objApplication.Selection.InsertFile strTemplateDir & strAgrtType & " Variables IRS.doc"
			intFlagCtrlCSC = 1	
'fin Thomas
		    		    
		    ElseIf (Ucase(strPricingModel) = "EURIBOROPTIMISE") Then
                	'objApplication.Selection.InsertFile strTemplateDir & strAgrtType & " Variables formules EUROPT IRS.doc"
			'FlagLegFXDigit = 1
                ElseIf (Ucase(strPricingModel) = "OVERTEC") Then
	          	'objApplication.Selection.InsertFile strTemplateDir & strAgrtType & " Variables formules OVERTEC.doc"
			If (strIdx="EUR-TEC10-CNO") Then
      			objDocument.Bookmarks("olfTec10_1").Select
	      		objApplication.Selection.Delete
		      	objDocument.Bookmarks("olfTec10_2").Select
				objApplication.Selection.Delete
				objApplication.Selection.TypeBackspace
			End If
			'FlagLegFXDigit = 1
		    ElseIf (Ucase(strReference) = "TIPTOPCAP") Then
			'objApplication.Selection.InsertFile strTemplateDir & strAgrtType & " Variables formules TipTop Cap IRS.doc"
			'FlagLegFXDigit = 1
		    ElseIf (strolfInsType = "CSC" Or strolfInsType = "CSC-B" Or strolfInsType = "ST-CSC") Then
			'objApplication.Selection.InsertFile strTemplateDir & strAgrtType & " Variables IRS.doc"
			'Begin_ref22
			intFlagCtrlCSC = 1
			'End_ref22
		    ElseIf (intFirstFMLA = 0 And Ucase(strReference) = "ACTIFIX") Then
			'objApplication.Selection.InsertFile strTemplateDir & strAgrtType & " Variables formule 1 Actifix IRS.doc"
			intFirstFMLA = 1
		    ElseIf (intFirstFMLA = 1 And Ucase(strReference) = "ACTIFIX") Then
			'objApplication.Selection.InsertFile strTemplateDir & strAgrtType & " Variables formule 2 Actifix IRS.doc"
		    ElseIf (Ucase(strReference) = "FIXMS" or Ucase(strReference) = "DIGICMS")Then
			'objApplication.Selection.InsertFile strTemplateDir & strAgrtType & " Variables formules FIXMS.doc"		
			'FlagLegFXDigit = 1
		    ' DCH Dual --- DEK  rajout de FXDigit ref55 --
                ElseIf (Ucase(strReference) = "DUAL" Or UCase(strPricingModel)= "FXDIGIT") Then
			'objApplication.Selection.InsertFile strTemplateDir & strAgrtType & " Variables formules DUAL.doc"
 	 		If (Ucase(strProjIdx2) = "FXPTS_EUR.CHF") then
				objDocument.Bookmarks("olfTranscoProjIdx_1").Range.Text = ""
 				objDocument.Bookmarks("olfDigifixLib2").Range.Text = ""
			ElseIf (Ucase(strProjIdx2) = "FXPTS_USD.JPY") then
				objDocument.Bookmarks("olfTranscoProjIdx").Range.Text = ""
				objDocument.Bookmarks("olfDigifixLib1").Range.Text = ""
			End If
			'FlagLegFXDigit = 1
		    'DEK  rajout de FXFloater ref56
                ElseIf (UCase(strPricingModel)= "FXFLOATER") Then
			'objApplication.Selection.InsertFile strTemplateDir & strAgrtType & " Variables formules DUAL.doc"
 	 		If (Ucase(strProjIdx2) = "FXPTS_EUR.CHF") then
				objDocument.Bookmarks("olfTranscoProjIdx_1").Range.Text = ""
 				objDocument.Bookmarks("olfDigifixLib2").Range.Text = ""
			ElseIf (Ucase(strProjIdx2) = "FXPTS_USD.JPY") then
				objDocument.Bookmarks("olfTranscoProjIdx").Range.Text = ""
				objDocument.Bookmarks("olfDigifixLib1").Range.Text = ""
			End If
			'olfFXFloater_FX0
			'strFXFloaterFx0 = xmlNode.selectSingleNode("olfFXFloaterFx0").Text
			strFXFloaterFx0 = xmlNode.selectSingleNode("olfConstante1").Text
                  objDocument.Bookmarks("olfFXFloaterFx0").Range.Text = strFXFloaterFx0
			'olfProjIndex
    			objDocument.Bookmarks("olfProjIdx").Range.Text = strIdx
			'olfIdxTenor
    			objDocument.Bookmarks("olfIdxTenor").Range.Text = strPeriod
			'olfRstHolSchd
			strRstHolSchd =xmlNode.selectSingleNode("olfRstHolSchd").Text
			objDocument.Bookmarks("olfRstHolSchd").Range.Text = strRstHolSchd
			objDocument.Bookmarks("olfRstHolSchd_1").Range.Text = strRstHolSchd
			'olfRstShift
	      	strRstShift2 = xmlNode.selectSingleNode("olfResetShiftFX").Text
    			objDocument.Bookmarks("olfRstShift").Range.Text = strRstShift2
			'olfFXFloater_Spread * 100
			strFXFloaterSpd = xmlNode.selectSingleNode("olfFXFloaterSpd").Text
                  objDocument.Bookmarks("olfFXFloaterSpd").Range.Text = strFXFloaterSpd
	   	      'FlagLegFXDigit = 1

                'DCH Begin_ref51
		    ' stop
		    ElseIf (Ucase(Cd_rgpt_str) = "TFAINF" Or Ucase(Cd_rgpt_str) = "TEAINF") Then
		    	'objApplication.Selection.InsertFile strTemplateDir & strAgrtType & " Variables formules inflation IRS.doc"
			If (Ucase(Cd_rgpt_str) = "TEAINF") then
				'recup Coeff_2
	                  objDocument.Bookmarks("olfConstante2").Range.Text = strCte2
				objDocument.Bookmarks("olfConstante2_1").Range.Text = strCte2
				
				'olfIdxTenor
	    			strPeriod3 = xmlNode.selectSingleNode("olfIndexTenorIdx2").Text
				objDocument.Bookmarks("olfIdxTenor").Range.Text = strPeriod3
				
				'olfProjIndex
	    			objDocument.Bookmarks("olfProjIdx").Range.Text = strIdx2			
	
				'olfDelPymt
    				strDelPymt =xmlNode.selectSingleNode("olfDelPymtIdx2").Text
	    			objDocument.Bookmarks("olfDelPymt").Range.Text = strDelPymt

				'olfRstHolSchd
				strRstHolSchd2 =xmlNode.selectSingleNode("olfRstHolSchdIdx2").Text
				objDocument.Bookmarks("olfRstHolSchd").Range.Text = strRstHolSchd2
			End If

			' recup olfMincoupon
			strolfMinCoupon = xmlNode.selectSingleNode("olfMinCoupon").Text
                  objDocument.Bookmarks("olfMinCoupon").Range.Text = strolfMinCoupon

			'olfFltSpd
			strolfFltSpd = xmlNode.selectSingleNode("olfFltSpd").Text
                  objDocument.Bookmarks("olfFltSpd").Range.Text = strolfFltSpd

			'olfBarrierRate
			strolfBarrierRate = xmlNode.selectSingleNode("olfBarrierRate").Text
                  objDocument.Bookmarks("olfBarrierRate").Range.Text = strolfBarrierRate

			'olfIdxName
    			strolfIdxName =xmlNode.selectSingleNode("olfIdxName").Text
    			objDocument.Bookmarks("olfIdxName").Range.Text = strolfIdxName
			objDocument.Bookmarks("olfIdxName_1").Range.Text = strolfIdxName
			objDocument.Bookmarks("olfIdxName_2").Range.Text = strolfIdxName

			'olfPublishTable
    			strolfPublishTable =xmlNode.selectSingleNode("olfPublishTable").Text
    			objDocument.Bookmarks("olfPublishTable").Range.Text = strolfPublishTable

			'olfRfiShift
    			strolfRfiShift =xmlNode.selectSingleNode("olfRfiShift").Text
    			objDocument.Bookmarks("olfRfiShift").Range.Text = strolfRfiShift

			'olfRfiShift2
    			strolfRfiShift2 =xmlNode.selectSingleNode("olfRfiShift2").Text
    			objDocument.Bookmarks("olfRfiShift2").Range.Text = strolfRfiShift2

			'olfRFIS1CPI
    			strolfRFIS1CPI =xmlNode.selectSingleNode("olfRFIS1CPI").Text
    			objDocument.Bookmarks("olfRFIS1CPI").Range.Text = strolfRFIS1CPI

			'olfRFIS1
    			strolfRFIS1 =xmlNode.selectSingleNode("olfRFIS1").Text
    			objDocument.Bookmarks("olfRFIS1").Range.Text = strolfRFIS1

			'olfEndDate1
    			strolfEndDate1 =xmlNode.selectSingleNode("olfEndDate1").Text
    			objDocument.Bookmarks("olfEndDate1").Range.Text = strolfEndDate1
			
			'FlagLegFXDigit = 1

                ElseIf (Ucase(strReference) = "EXPERTYS" and strAgrtType = "ISDA") Then
		    	'objApplication.Selection.InsertFile strTemplateDir & strAgrtType & " Variables formules EXPERTYS.doc"
		    	
		    	'olfIndexMeans
			strIndexMeans = xmlNode.selectSingleNode("olfIndexMeans").Text
                  objDocument.Bookmarks("olfIndexMeans").Range.Text = strIndexMeans

		    	strIndexMeans2 = xmlNode.selectSingleNode("olfIndexMeans2").Text
    			objDocument.Bookmarks("olfIndexMeans_bis").Range.Text = strIndexMeans2
    			
    			'olfPublishedOn
			strPublishedOn = xmlNode.selectSingleNode("olfPublishedOn").Text
			objDocument.Bookmarks("olfPublishedOn").Range.Text = strPublishedOn
			strPublishedOn2 = xmlNode.selectSingleNode("olfPublishedOn2").Text
    			objDocument.Bookmarks("olfPublishedOn_bis").Range.Text = strPublishedOn2

			'olfSpread
    			If (Ucase(Cd_rgpt_str) <> "EXPRTF" And Ucase(Cd_rgpt_str) <> "MCEXTF" And Ucase(Cd_rgpt_str) <> "EXPDTF" And Ucase(Cd_rgpt_str) <> "MCDIXF") Then
				strConstante1 = xmlNode.selectSingleNode("olfConstante1").Text
				objDocument.Bookmarks("olfSpread").Range.Text = strConstante1
			End If
			    			
			'olfRefRate
			If (Ucase(Cd_rgpt_str) = "EXPRTF" Or Ucase(Cd_rgpt_str) = "MCEXTF" Or Ucase(Cd_rgpt_str) = "EXPDTF" Or Ucase(Cd_rgpt_str) = "MCDIXF") Then
    				strConstante1 = xmlNode.selectSingleNode("olfConstante1").Text
				objDocument.Bookmarks("olfRefRate").Range.Text = strConstante1
			End If
			
			'olfMaxCoupon => Barrier Rate
			If (Ucase(Cd_rgpt_str) = "EXPREC" or Ucase(Cd_rgpt_str) = "MCEXEC" or Ucase(Cd_rgpt_str) = "EXPDEC" or Ucase(Cd_rgpt_str) = "MCDIXC") Then
				strMaxCoupon = xmlNode.selectSingleNode("olfMaxCoupon").Text
    				objDocument.Bookmarks("olfMaxCoupon").Range.Text = strMaxCoupon
			End If    			

    			'olfProjIndex
    			objDocument.Bookmarks("olfProjIdx").Range.Text = strIdx
    		    			
    			'olfIdxTenor
    			objDocument.Bookmarks("olfIdxTenor").Range.Text = strPeriod
    			
    			'olfDelPymt
    			strDelPymt =xmlNode.selectSingleNode("olfDelPymt").Text
    			objDocument.Bookmarks("olfDelPymt").Range.Text = strDelPymt
    			
    			'olfDelPymtIdx2
			strDelPymtIdx2 =xmlNode.selectSingleNode("olfDelPymtIdx2").Text
			objDocument.Bookmarks("olfDelPymtIdx2").Range.Text = strDelPymtIdx2

			'olfDelPymtIdx3
			strDelPymtIdx3 =xmlNode.selectSingleNode("olfDelPymtIdx3").Text
			objDocument.Bookmarks("olfDelPymtIdx3").Range.Text = strDelPymtIdx3
                 			
    			'olfRstHolSchdIdx2
			strRstHolSchdIdx3 =xmlNode.selectSingleNode("olfRstHolSchdIdx3").Text
    			objDocument.Bookmarks("olfRstHolSchdIdx2").Range.Text = strRstHolSchdIdx3
    			
    			'olfRstHolSchdIdx2_bis
    			strRstHolSchdIdx2 =xmlNode.selectSingleNode("olfRstHolSchdIdx2").Text
    			objDocument.Bookmarks("olfRstHolSchdIdx2_bis").Range.Text = strRstHolSchdIdx2
    			
			'olfRstHolSchdIdx2_ter
			strRstHolSchdIdx2ter =xmlNode.selectSingleNode("olfRstHolSchd").Text
			objDocument.Bookmarks("olfRstHolSchdIdx2_ters").Range.Text = strRstHolSchdIdx2ter

			'olfRstHolSchd
			strRstHolSchd =xmlNode.selectSingleNode("olfRstHolSchd").Text
			objDocument.Bookmarks("olfRstHolSchd").Range.Text = strRstHolSchd

    			'olfIndexTenorSansY (reset2)
    			strIndexTenorSansY = xmlNode.selectSingleNode("olfIndexTenorSansY").Text
    			objDocument.Bookmarks("olfIndexTenorSansY").Range.Text = strIndexTenorSansY
			
			'olfIndexTenorSansY (reset3)
			strIndexTenor2SansY = xmlNode.selectSingleNode("olfIndexTenor2SansY").Text
    			objDocument.Bookmarks("olfIndexTenor2SansY").Range.Text = strIndexTenor2SansY
		    
		    ElseIf (Ucase(strReference) = "EXPERTYS" and strAgrtType = "AFB") Then
			'objApplication.Selection.InsertFile strTemplateDir & strAgrtType & " Variables formules EXPERTYS.doc"

		    	'olfIndexMeans
			strIndexMeans = xmlNode.selectSingleNode("olfIndexMeans").Text
                  objDocument.Bookmarks("olfIndexMeans").Range.Text = strIndexMeans

		    	strIndexMeans2 = xmlNode.selectSingleNode("olfIndexMeans2").Text
    			objDocument.Bookmarks("olfIndexMeans_bis").Range.Text = strIndexMeans2
    			
    			'olfPublishedOn
			strPublishedOn = xmlNode.selectSingleNode("olfPublishedOn").Text
			objDocument.Bookmarks("olfPublishedOn").Range.Text = strPublishedOn
			strPublishedOn2 = xmlNode.selectSingleNode("olfPublishedOn2").Text
    			objDocument.Bookmarks("olfPublishedOn_bis").Range.Text = strPublishedOn2

			'olfSpread
    			If (Ucase(Cd_rgpt_str) <> "EXPRTF" And Ucase(Cd_rgpt_str) <> "MCEXTF" And Ucase(Cd_rgpt_str) <> "EXPDTF" And Ucase(Cd_rgpt_str) <> "MCDIXF") Then
				strConstante1 = xmlNode.selectSingleNode("olfConstante1").Text
				objDocument.Bookmarks("olfSpread").Range.Text = strConstante1
			End If
			    			
			'olfRefRate
			If (Ucase(Cd_rgpt_str) = "EXPRTF" Or Ucase(Cd_rgpt_str) = "MCEXTF" Or Ucase(Cd_rgpt_str) = "EXPDTF" Or Ucase(Cd_rgpt_str) = "MCDIXF") Then
    				strConstante1 = xmlNode.selectSingleNode("olfConstante1").Text
				objDocument.Bookmarks("olfRefRate").Range.Text = strConstante1
			End If
			
			'olfMaxCoupon => Barrier Rate
			If (Ucase(Cd_rgpt_str) = "EXPREC" or Ucase(Cd_rgpt_str) = "MCEXEC" or Ucase(Cd_rgpt_str) = "EXPDEC" or Ucase(Cd_rgpt_str) = "MCDIXC") Then
				strMaxCoupon = xmlNode.selectSingleNode("olfMaxCoupon").Text
    				objDocument.Bookmarks("olfMaxCoupon").Range.Text = strMaxCoupon
			End If    			

    			'olfProjIndex
			strTxRef = xmlNode.selectSingleNode("olfProjIndex").Text
  			if strTxRef = "EUR-EURIBOR-Telerate" then
				strTxRef = "EUR-EURIBOR-Telerate " + strPeriod + ", soit le taux pour les dépôts " _
                                                                           + "en euros pour une période de " + strPeriod + " tel que publié sur la P" _
                                                                           + "age Telerate 248 à 11h heure de Bruxelles."

				objDocument.Bookmarks("olfTxRef").Range.Text = strTxRef 
			End If

		    Else
			'objApplication.Selection.InsertFile strTemplateDir & strAgrtType & " Variables formules IRS.doc"
			'FlagLegFXDigit = 1
		    End If

		    'Begin_ref22
		    ' stop	
                if intFlagCtrlCSC = 1 And strAgrtType = "ISDA" Then
		    	if strolfInsType = "CSC" or strolfInsType = "CSC-B" or strolfInsType = "ST-CSC" Then
				'on intregre le notional amount
				strolfMttFANotAmt = xmlNode.selectSingleNode("olfNotnl").Text  ' mtt du notional
				objDocument.Bookmarks("olfMttFANotAmt").Range.Text = strolfMttFANotAmt
				strolfDevFANotAmt = xmlNode.selectSingleNode("olfNotnlCcy").Text  ' devise du notional
				objDocument.Bookmarks("olfDevFANotAmt").Range.Text = strolfDevFANotAmt
			Else
				'on supprime le bloc concernant le notional amount
				objDocument.Bookmarks("olfMttFANotAmt").Select
				objApplication.Selection.Delete
				objApplication.Selection.TypeBackspace
				objDocument.Bookmarks("olfDevFANotAmt").Select
				objApplication.Selection.Delete
				objApplication.Selection.TypeBackspace
				objDocument.Bookmarks("olfTitleFANotAmt").Select
				objApplication.Selection.Delete
				objApplication.Selection.TypeBackspace
			End If
		    End If 
                'End_ref22

		    If strAgrtType = "AFB" Then
                	objDocument.Bookmarks("centres").Select
                	objApplication.Selection.Collapse wdCollapseStart
                	objApplication.Selection.MoveLeft (1)
			If (strReset <> "N/A" And Ucase(strPricingModel) = "EURIBOROPTIMISE") Then
	                	'objApplication.Selection.InsertFile strTemplateDir & "Centres Financiers EUROPT.doc"
			Else
				'objApplication.Selection.InsertFile strTemplateDir & "centres Financiers.doc"
			End If
		
		    	objDocument.Bookmarks("delLine").Delete
                	objDocument.Bookmarks("jours").Select
                	objApplication.Selection.Collapse wdCollapseStart
                	objApplication.Selection.MoveLeft (1)
                	'objApplication.Selection.InsertFile strTemplateDir & "Jours Ouvre.doc"
                End If
		    CptVar = CptVar + 1
		    NumFltAmnt = NumFltAmnt + CStr(CptVar) + ", "

		    If (intflagAdUnad = 1 And UCase(strLastLeg)= "O" And UCase(strLegUnad) = "N") Then
 			strLblTermAdjDate = " for Floating Amount " + CStr(CptVar)
			NumFltAdjAmnt = NumFltAdjAmnt + strFltAdjSeparateur + CStr(CptVar)
			strFltAdjSeparateur = ", "
			intAllLegUnad = 1
		    ElseIf (intflagAdUnad = 1 And UCase(strLastLeg)= "O" And UCase(strLegUnad) = "O") Then
			strLblTermNonAdjDate = " for Floating Amount " + CStr(CptVar)

			NumFltNonAdjAmnt = NumFltNonAdjAmnt + strFltSeparateur + CStr(CptVar)
			strFltSeparateur = ", "
		    ElseIf (intflagAdUnad = 0 And UCase(strLastLeg)= "O" And UCase(strLegUnad) = "O") Then
			NumFltNonAdjAmnt = NumFltNonAdjAmnt + strFltSeparateur + CStr(CptVar)
			strFltSeparateur = ", "
                ElseIf (UCase(strLastLeg)= "N" And UCase(strLegUnad) = "O") Then
			NumFltNonAdjAmnt = NumFltNonAdjAmnt + strFltSeparateur + CStr(CptVar) 
			strFltSeparateur = ", "
		    Else
			NumFltAdjAmnt = NumFltAdjAmnt + strFltAdjSeparateur + CStr(CptVar)
			strFltAdjSeparateur = ", "
			intAllLegUnad = 1
		    End If
		    flag = 1    ' on a déjà insérer les .doc
            End If
            
		If objDocument.Bookmarks.Exists(xmlSubNode.nodeName) Then
		    If strAgrtType = "ISDA" Then
			Call DOC_PopulateSWT(objApplication, objDocument, xmlSubNode.nodeName, xmlSubNode.Text, CptVar, strPeriod, strFxFlt, strCte1, strMonoPeriod, strRstShift, Cd_rgpt_str)
		    Else
			If (xmlSubNode.nodeName = "olfStartDate" And intFirstLeg = 0) Then 
			  	Call DOC_PopulateAFB_FLT(objApplication,objDocument, xmlSubNode.nodeName, xmlSubNode.Text, CptVar, strPeriod, strPeriod2, strMonoPeriod, intFirstLeg)
				intFirstLeg = 1 
			Else 
			  	Call DOC_PopulateAFB_FLT(objApplication,objDocument, xmlSubNode.nodeName, xmlSubNode.Text, CptVar, strPeriod, strPeriod2, strMonoPeriod, intFirstLeg)
			End If
                End If 	
            End If

		'debut thomas
		'If (UCase(strReference)="DIGICMS" And objDocument.Bookmarks.Exists("olfDel4DigiCMS")) Then
	      	'objDocument.Bookmarks("olfDel4DigiCMS").Select
			'objApp.Selection.Delete
		'End If
		'fin thomas

	  'branches Pay Fix 
        ElseIf (UCase(strPayRec) = "PAY" And UCase(strFxFlt) <> "FLOAT") Then
        	If flag = 0 Then
		'Thomas
                'objApplication.Selection.InsertFile strTemplateDir & strAgrtType & " Fixes.doc"
		'fin Thomas		    
		    If strAgrtType = "AFB" Then
                	objDocument.Bookmarks("centres").Select
	            objApplication.Selection.Collapse wdCollapseStart
      	      objApplication.Selection.MoveLeft (1)
            	'objApplication.Selection.InsertFile strTemplateDir & "Centres Financiers.doc"
		    	objDocument.Bookmarks("delLine").Select
  	 	    	objApplication.Selection.Delete
		  	objApplication.Selection.TypeBackspace
		    	objApplication.Selection.TypeBackspace
                	objDocument.Bookmarks("jours").Select
                	objApplication.Selection.Collapse wdCollapseStart
                	objApplication.Selection.MoveLeft (1)
                	'objApplication.Selection.InsertFile strTemplateDir & "Jours Ouvre.doc"
		    End If
		    'Begin_ref22 	
		    If strAgrtType = "ISDA" Then
                ' gestion du bloc Notionel Amount
			if strolfInsType = "CSC" or strolfInsType = "CSC-B" or strolfInsType = "ST-CSC" Then
				'on integre le notional amount
				strolfMttFxNotAmt = xmlNode.selectSingleNode("olfNotnl").Text  ' mtt du notional
				objDocument.Bookmarks("olfMttFxNotAmt").Range.Text = strolfMttFxNotAmt
				strolfDevFxNotAmt = xmlNode.selectSingleNode("olfNotnlCcy").Text  ' devise du notional
				objDocument.Bookmarks("olfDevFxNotAmt").Range.Text = strolfDevFxNotAmt
			Else
				'on supprime le bloc concernant le notional amount
				objDocument.Bookmarks("olfMttFxNotAmt").Select
				objApplication.Selection.Delete
				objApplication.Selection.TypeBackspace
				objDocument.Bookmarks("olfDevFxNotAmt").Select
				objApplication.Selection.Delete
				objApplication.Selection.TypeBackspace
				objDocument.Bookmarks("olfTitleFxNotAmt").Select
				objApplication.Selection.Delete
				objApplication.Selection.TypeBackspace 
		
			End If
		    End If
		    'End_ref22

                CptFix = CptFix + 1
		    NumFxAmnt = NumFxAmnt + CStr(CptFix) + ", "
                If (intflagAdUnad = 1 And UCase(strLastLeg)= "O" And UCase(strLegUnad) = "N") Then
 			strLblTermAdjDate = " for Fixed Amount " + CStr(CptFix)
			NumFxAdjAmnt = NumFxAdjAmnt + strFxAdjSeparateur + CStr(CptFix)
			intAllLegUnad = 1
			strFxAdjSeparateur = ", "
		    ElseIf (intflagAdUnad = 1 And UCase(strLastLeg)= "O" And UCase(strLegUnad) = "O") Then
			strLblTermNonAdjDate = " for Fixed Amount " + CStr(CptFix)
			NumFxNonAdjAmnt = NumFxNonAdjAmnt + strFxSeparateur + CStr(CptFix) 
			strFxSeparateur = ", "
		    ElseIf (intflagAdUnad = 0 And UCase(strLastLeg)= "O" And UCase(strLegUnad) = "O") Then
			NumFxNonAdjAmnt = NumFxNonAdjAmnt +  strFxSeparateur + CStr(CptFix) 
			strFxSeparateur = ", "
                   ElseIf (UCase(strLastLeg)= "N" And UCase(strLegUnad) = "O") Then
			NumFxNonAdjAmnt = NumFxNonAdjAmnt + strFxSeparateur + CStr(CptFix) 
			strFxSeparateur = ", "
		    Else
			NumFxAdjAmnt = NumFxAdjAmnt + strFxAdjSeparateur + CStr(CptFix)
			intAllLegUnad = 1
			strFxAdjSeparateur = ", "
		    End If
                flag = 1
            End If
            If objDocument.Bookmarks.Exists(xmlSubNode.nodeName) Then
		    If strAgrtType = "ISDA" Then
			Call DOC_PopulateSWT(objApplication,objDocument, xmlSubNode.nodeName, xmlSubNode.Text, CptFix, strPeriod, strFxFlt, strCte1, strMonoPeriod, strRstShift, Cd_rgpt_str)
		    Else 
			If (xmlSubNode.nodeName = "olfStartDate" And intFirstLeg = 0) Then 
				Call DOC_PopulateAFB_FIX(objApplication,objDocument, xmlSubNode.nodeName, xmlSubNode.Text, CptFix, strPeriod, strMonoPeriod, intFirstLeg)
				intFirstLeg = 1
			Else 
				Call DOC_PopulateAFB_FIX(objApplication,objDocument, xmlSubNode.nodeName, xmlSubNode.Text, CptFix, strPeriod, strMonoPeriod, intFirstLeg)
			End If
                End If 	
            End If
        End If
      Next
      flag = 0	
    Next
    intFirstLeg = 0
    intFirstFMLA = 0
    'Puis des jambes receive
    flag = 0
    For Each xmlNode In xmldoc.documentElement.childNodes
       
	'objDocument.Bookmarks("jambes").Select
      
      objApplication.Selection.Collapse wdCollapseStart
      objApplication.Selection.MoveLeft (1)
         
      'et on fusionne les sous-noeuds existants dans Word (exemple olfNotnl, supposant que le bookmark a le même nom que le noeud xml)
      For Each xmlSubNode In xmlNode.childNodes
            strPayRec = xmlNode.selectSingleNode("olfPayRec").Text
            strFxFlt = xmlNode.selectSingleNode("olfFxFlt").Text
		strMonoPeriod = xmlNode.selectSingleNode("olfMonoPeriod").Text
            strLastLeg = xmlNode.selectSingleNode("olfLastLeg").Text 
            strLegUnad = xmlNode.selectSingleNode("olfLegUnad").Text
		intFlagCtrlCSC = 0 



            If (UCase(strPayRec) = "RECEIVE" And UCase(strFxFlt) = "FLOAT") Then
		    strIdx = xmlNode.selectSingleNode("olfProjIndex").Text
                strIdx2 = xmlNode.selectSingleNode("olfProjIndex2").Text
	          strPeriod = xmlNode.selectSingleNode("olfIndexTenor").Text
                strRstShift = xmlNode.selectSingleNode("olfResetShift").Text
                strCte1 = xmlNode.selectSingleNode("olfConstante1").Text
                strCte2 = xmlNode.selectSingleNode("olfConstante2").Text
		    'strCte3 = xmlNode.selectSingleNode("olfConstante3").Text	
		    strBarrier1 = xmlNode.selectSingleNode("olfBarrier1").Text
                strReset = xmlNode.selectSingleNode("olfReset").Text
                strPeriod2 = xmlNode.selectSingleNode("olfIndex2Tenor").Text
		    



			'Dual
		    strProjIdx2 = xmlNode.selectSingleNode("olfProjIndex2").Text
                If flag = 0 Then
' JML, tout un bloc supprimé ici et sauvegardé en tant que yoyo1.txt
			CptVar = CptVar + 1
			NumFltAmnt = NumFltAmnt + CStr(CptVar) + ", "
			    
                	If (intflagAdUnad = 1 And UCase(strLastLeg)= "O" And UCase(strLegUnad) = "N") Then
 				strLblTermAdjDate = " for Floating Amount " + CStr(CptVar)
				NumFltAdjAmnt = NumFltAdjAmnt + strFltAdjSeparateur + CStr(CptVar) 
				intAllLegUnad = 1
				strFltAdjSeparateur = ", "
		      ElseIf (intflagAdUnad = 1 And UCase(strLastLeg)= "O" And UCase(strLegUnad) = "O") Then
				strLblTermNonAdjDate = " for Floating Amount " + CStr(CptVar)
				NumFltNonAdjAmnt = NumFltNonAdjAmnt + strFltSeparateur + CStr(CptVar)	          
				strFltSeparateur = ", "
			ElseIf (intflagAdUnad = 0 And UCase(strLastLeg)= "O" And UCase(strLegUnad) = "O") Then
				NumFltNonAdjAmnt = NumFltNonAdjAmnt + strFltSeparateur + CStr(CptVar) 
				strFltSeparateur = ", "
		      ElseIf (UCase(strLastLeg)= "N" And UCase(strLegUnad) = "O") Then
				NumFltNonAdjAmnt = NumFltNonAdjAmnt + strFltSeparateur + CStr(CptVar) 
				strFltSeparateur = ", "
		      Else
				NumFltAdjAmnt = NumFltAdjAmnt + strFltAdjSeparateur + CStr(CptVar)
				intAllLegUnad = 1
				strFltAdjSeparateur = ", "
		      End If
			flag = 1                        
                End If

                strPeriod = xmlNode.selectSingleNode("olfIndexTenor").Text
                strPeriod2 = xmlNode.selectSingleNode("olfIndex2Tenor").Text
                
		    If objDocument.Bookmarks.Exists(xmlSubNode.nodeName) Then
      		If strAgrtType = "ISDA" Then                  
			 	Call DOC_PopulateSWT(objApplication, objDocument, xmlSubNode.nodeName, xmlSubNode.Text, CptVar, strPeriod, strFxFlt, strCte1, strMonoPeriod, strRstShift, Cd_rgpt_str)
		    	Else 
				If (xmlSubNode.nodeName = "olfStartDate" And intFirstLeg = 0) Then 
			 		Call DOC_PopulateAFB_FLT(objApplication, objDocument, xmlSubNode.nodeName, xmlSubNode.Text, CptVar, strPeriod, strPeriod2, strMonoPeriod, intFirstLeg)
					intFirstLeg = 1
				Else
			 		Call DOC_PopulateAFB_FLT(objApplication, objDocument, xmlSubNode.nodeName, xmlSubNode.Text, CptVar, strPeriod, strPeriod2, strMonoPeriod, intFirstLeg)
				End If 	
               	End If 	
                End If


		    'debut thomas
		        If (UCase(strReference)="DIGICMS" And objDocument.Bookmarks.Exists("olfDel4DigiCMS")) Then
			       objDocument.Bookmarks("olfDel4DigiCMS").Select
			       objApp.Selection.Delete
		        End If
		    'fin thomas

            
            ElseIf (UCase(strPayRec) = "RECEIVE" And UCase(strFxFlt) <> "FLOAT") Then
                If flag = 0 Then
'Thomas
                    'objApplication.Selection.InsertFile strTemplateDir & strAgrtType & " Fixes.doc"
'fin Thomas


		        If strAgrtType = "AFB" Then
                    	objDocument.Bookmarks("centres").Select
                    	objApplication.Selection.Collapse wdCollapseStart
                    	objApplication.Selection.MoveLeft (1)
                    	'objApplication.Selection.InsertFile strTemplateDir & "Centres Financiers.doc"
			  	objDocument.Bookmarks("delLine").Select
			  	objApplication.Selection.Delete
			  	objApplication.Selection.TypeBackspace
			    	objApplication.Selection.TypeBackspace
                    	objDocument.Bookmarks("jours").Select
                    	objApplication.Selection.Collapse wdCollapseStart
      		  	objApplication.Selection.MoveLeft (1)
                    	'objApplication.Selection.InsertFile strTemplateDir & "Jours Ouvre.doc"
                    End If

			  'Begin_ref22 	
		    	  If strAgrtType = "ISDA" Then
                	  	' gestion du bloc Notionel Amount
				if strolfInsType = "CSC" or strolfInsType = "CSC-B" or strolfInsType = "ST-CSC" Then
					'on intregre le notional amount
					strolfMttFxNotAmt = xmlNode.selectSingleNode("olfNotnl").Text  ' mtt du notional
					objDocument.Bookmarks("olfMttFxNotAmt").Range.Text = strolfMttFxNotAmt
					strolfDevFxNotAmt = xmlNode.selectSingleNode("olfNotnlCcy").Text  ' devise du notional
					objDocument.Bookmarks("olfDevFxNotAmt").Range.Text = strolfDevFxNotAmt
				Else
					'on supprime le bloc concernant le notional amount
					objDocument.Bookmarks("olfMttFxNotAmt").Select
					objApplication.Selection.Delete
					objApplication.Selection.TypeBackspace
					objDocument.Bookmarks("olfDevFxNotAmt").Select
					objApplication.Selection.Delete
					objApplication.Selection.TypeBackspace
					objDocument.Bookmarks("olfTitleFxNotAmt").Select
					objApplication.Selection.Delete
					objApplication.Selection.TypeBackspace 
				End If
		    	  End If
		    	  'End_ref22

			  CptFix = CptFix + 1
			  NumFxAmnt = NumFxAmnt + CStr(CptFix) + ", " 
		        If (intflagAdUnad = 1 And UCase(strLastLeg)= "O" And UCase(strLegUnad) = "N") Then
 				strLblTermAdjDate = " for Fixed Amount " + CStr(CptFix)
				NumFxAdjAmnt = NumFxAdjAmnt + strFxAdjSeparateur + CStr(CptFix)
				intAllLegUnad = 1
				strFxAdjSeparateur = ", "
		        ElseIf (intflagAdUnad = 1 And UCase(strLastLeg)= "O" And UCase(strLegUnad) = "O") Then
				strLblTermNonAdjDate = " for Fixed Amount " + CStr(CptFix)
				NumFxNonAdjAmnt = NumFxNonAdjAmnt + strFxSeparateur + CStr(CptFix)
				strFxSeparateur = ", "
		        ElseIf (intflagAdUnad = 0 And UCase(strLastLeg)= "O" And UCase(strLegUnad) = "O") Then
				NumFxNonAdjAmnt = NumFxNonAdjAmnt + strFxSeparateur + CStr(CptFix)
				strFxSeparateur = ", "
		        ElseIf (UCase(strLastLeg)= "N" And UCase(strLegUnad) = "O") Then
				NumFxNonAdjAmnt = NumFxNonAdjAmnt + strFxSeparateur + CStr(CptFix) 
				strFxSeparateur = ", "
		        Else
				NumFxAdjAmnt = NumFxAdjAmnt + strFxAdjSeparateur + CStr(CptFix)
				intAllLegUnad = 1
				strFxAdjSeparateur = ", "
		        End If
                    flag = 1
                End If
                If objDocument.Bookmarks.Exists(xmlSubNode.nodeName) Then
      			If strAgrtType = "ISDA" Then
				 	Call DOC_PopulateSWT(objApplication,objDocument, xmlSubNode.nodeName, xmlSubNode.Text, CptFix, strPeriod, strFxFlt, strCte1, strMonoPeriod, strRstShift, Cd_rgpt_str)
		    		Else 
					If (xmlSubNode.nodeName = "olfStartDate" And intFirstLeg = 0) Then
						Call DOC_PopulateAFB_FIX(objApplication, objDocument, xmlSubNode.nodeName, xmlSubNode.Text, CptFix, strPeriod, strMonoPeriod, intFirstLeg)
						intFirstLeg = 1
					Else
						Call DOC_PopulateAFB_FIX(objApplication, objDocument, xmlSubNode.nodeName, xmlSubNode.Text, CptFix, strPeriod, strMonoPeriod, intFirstLeg)
					End If
             		End If 	
                End If
            End If
      Next
      flag = 0

    Next
' Begin_ref59 -- DEK rajout de FXDigit ref 55 --
If (Ucase(strReference) = "FIXMS" or Ucase(strReference) = "DIGICMS" or Ucase(strReference) = "DUAL" or UCase(strPricingModel)= "FXDIGIT" Or UCase(strPricingModel)= "FXFLOATER") Then
	If (Ucase(StrFlagOpt) = "1") then
		objDocument.Bookmarks("olfExtBuName").Range.Text = strExtBU 
		objDocument.Bookmarks("olfExtBuName_2").Range.Text = strExtBU 
		objDocument.Bookmarks("olfExtBuName_3").Range.Text = strExtBU 
 		objDocument.Bookmarks("olfIntBuName").Range.Text = strIntLent 
		objDocument.Bookmarks("olfIntBuName_2").Range.Text = strIntLent 
		objDocument.Bookmarks("olfIntBuName_3").Range.Text = strIntLent 
		objDocument.Bookmarks("olfIntBuName_4").Range.Text = strIntLent 
		objDocument.Bookmarks("olfIntBuName_5").Range.Text = strIntLent 
		objDocument.Bookmarks("olfIntBuName_6").Range.Text = strIntLent 
		objDocument.Bookmarks("olfIntBuName_7").Range.Text = strIntLent

					
		objDocument.Bookmarks("olfTranMaturity_1").Range.Text = strolfTranMaturityDate
		objDocument.Bookmarks("olfPymtConv_1").Range.Text = strolfOptPymtConv
		
				
		If (UCase(OLF_GetField("olfOptStyle")) <> "BERMUDA") Then
			objDocument.Bookmarks("DelTermDate").Range.Text = "" 
      		'objDocument.Bookmarks("DelExpDate").Range.Text = "" 
			objDocument.Bookmarks("DelOptDate1").Range.Text = "" 
			objDocument.Bookmarks("DelOptDate2").Range.Text = "" 
    		End If
	End If
End If
' End_ref59

' Begin_2.0
If (Ucase(strReference) = "EXPERTYS" and strAgrtType = "ISDA") Then
	If (Ucase(Cd_rgpt_str) = "EXPREU" OR Ucase(Cd_rgpt_str) = "MCEXEU" OR Ucase(Cd_rgpt_str) = "EXPDEU" OR Ucase(Cd_rgpt_str) = "MCDIXE") then
		objDocument.Bookmarks("olfFltRateBloc1").Select
		objApplication.Selection.Delete
		objApplication.Selection.TypeBackspace
		objDocument.Bookmarks("olfFltRateBloc2").Select
		objApplication.Selection.Delete
		objApplication.Selection.TypeBackspace
		objDocument.Bookmarks("olfFltRateBloc4").Select
		objApplication.Selection.Delete
		objApplication.Selection.TypeBackspace
		objApplication.Selection.TypeBackspace
		objDocument.Bookmarks("olfFltRateBloc6").Select
		objApplication.Selection.Delete
		objApplication.Selection.TypeBackspace
	ElseIf (Ucase(Cd_rgpt_str) = "EXPREC" OR Ucase(Cd_rgpt_str) = "MCEXEC" or Ucase(Cd_rgpt_str) = "EXPDEC" or Ucase(Cd_rgpt_str) = "MCDIXC") then
		objDocument.Bookmarks("olfFltRateBloc3").Select
		objApplication.Selection.Delete
		objApplication.Selection.TypeBackspace
		objDocument.Bookmarks("olfFltRateBloc4").Select
		objApplication.Selection.Delete
		objApplication.Selection.TypeBackspace
	ElseIf (Ucase(Cd_rgpt_str) = "EXPRTF" OR Ucase(Cd_rgpt_str) = "MCEXTF" OR Ucase(Cd_rgpt_str) = "EXPDTF" OR Ucase(Cd_rgpt_str) = "MCDIXF") then
		objDocument.Bookmarks("olfFltRateBloc1").Select
		objApplication.Selection.Delete
		objApplication.Selection.TypeBackspace
		objDocument.Bookmarks("olfFltRateBloc2").Select
		objApplication.Selection.Delete
		objApplication.Selection.TypeBackspace
		objDocument.Bookmarks("olfFltRateBloc3").Select
		objApplication.Selection.Delete
		objApplication.Selection.TypeBackspace
		objDocument.Bookmarks("olfFltRateBloc5").Select
		objApplication.Selection.Delete
		objApplication.Selection.TypeBackspace
		objDocument.Bookmarks("olfFltRateBloc6").Select
		objApplication.Selection.Delete
		objApplication.Selection.TypeBackspace
		objDocument.Bookmarks("olfFltRateBloc7").Select
		objApplication.Selection.Delete
		objApplication.Selection.TypeBackspace
	End IF
ElseIf (Ucase(strReference) = "EXPERTYS" and strAgrtType = "AFB") Then
	If (Ucase(Cd_rgpt_str) = "EXPREU" OR Ucase(Cd_rgpt_str) = "MCEXEU" OR Ucase(Cd_rgpt_str) = "EXPDEU" OR Ucase(Cd_rgpt_str) = "MCDIXE") then
		objDocument.Bookmarks("olfFltRateBloc2").Select
		objApplication.Selection.Delete
		objApplication.Selection.TypeBackspace
		objDocument.Bookmarks("olfFltRateBloc4").Select
		objApplication.Selection.Delete
		objDocument.Bookmarks("olfFltRateBloc6").Select
		objApplication.Selection.Delete
		objApplication.Selection.TypeBackspace
		objApplication.Selection.Delete
		objDocument.Bookmarks("olfFltRateBloc7").Select
		objApplication.Selection.Delete
		objApplication.Selection.TypeBackspace
		objDocument.Bookmarks("olfFltRateBloc8").Select
		objApplication.Selection.Delete
		objApplication.Selection.TypeBackspace
		objDocument.Bookmarks("olfFltRateBloc9").Select
		objApplication.Selection.Delete
		objApplication.Selection.TypeBackspace
	ElseIf (Ucase(Cd_rgpt_str) = "EXPREC" OR Ucase(Cd_rgpt_str) = "MCEXEC" or Ucase(Cd_rgpt_str) = "EXPDEC" or Ucase(Cd_rgpt_str) = "MCDIXC") then
		objDocument.Bookmarks("olfFltRateBloc2").Select
		objApplication.Selection.Delete
		objApplication.Selection.TypeBackspace
		objDocument.Bookmarks("olfFltRateBloc4").Select
		objApplication.Selection.Delete
		objApplication.Selection.TypeBackspace
		objDocument.Bookmarks("olfFltRateBloc10").Select
		objApplication.Selection.Delete
		objApplication.Selection.TypeBackspace
	ElseIf (Ucase(Cd_rgpt_str) = "EXPRTF" OR Ucase(Cd_rgpt_str) = "MCEXTF" OR Ucase(Cd_rgpt_str) = "EXPDTF" OR Ucase(Cd_rgpt_str) = "MCDIXF" ) then
		objDocument.Bookmarks("olfFltRateBloc1").Select
		objApplication.Selection.Delete
		objApplication.Selection.TypeBackspace
		objDocument.Bookmarks("olfFltRateBloc3").Select
		objApplication.Selection.Delete
		objApplication.Selection.TypeBackspace
		objDocument.Bookmarks("olfFltRateBloc5").Select
		objApplication.Selection.Delete
		objApplication.Selection.TypeBackspace
		objApplication.Selection.TypeBackspace
		objDocument.Bookmarks("olfFltRateBloc6").Select
		objApplication.Selection.Delete
		objApplication.Selection.TypeBackspace
		objApplication.Selection.Delete
		objDocument.Bookmarks("olfFltRateBloc7").Select
		objApplication.Selection.Delete
		objApplication.Selection.TypeBackspace
		objDocument.Bookmarks("olfFltRateBloc8").Select
		objApplication.Selection.Delete
		objApplication.Selection.TypeBackspace
		objDocument.Bookmarks("olfFltRateBloc9").Select
		objApplication.Selection.Delete
		objApplication.Selection.TypeBackspace
		objDocument.Bookmarks("olfFltRateBloc11").Select
		objApplication.Selection.Delete
		objApplication.Selection.TypeBackspace
	End IF
End If
' End_2.0


'Begin_ref22
If strAgrtType = "ISDA" Then
	'suppression du bloc Notional Amount du Transaction Detail (STD_TIPTOP_Confirmation)
	If strolfInsType = "CSC" or strolfInsType = "CSC-B" or strolfInsType = "ST-CSC" Then
		'suppression du titre
		objDocument.Bookmarks("olfTitleNotAmt").Select
		objApplication.Selection.Delete
		objApplication.Selection.TypeBackspace
		'suppression de la devise du notional
		objDocument.Bookmarks("olfTranNotnlCcy").Select
		objApplication.Selection.Delete
		objApplication.Selection.TypeBackspace
		'suppression du montant du notional
		objDocument.Bookmarks("olfTranNotnl").Select
		objApplication.Selection.Delete
		objApplication.Selection.TypeBackspace
            'ajout du bloc Initial and Final Exchange'
		objDocument.Bookmarks("olfBlocInitFinalExch").Select
		'objApplication.Selection.InsertFile strTemplateDir & strAgrtType & " Initial and Final Exchange.doc"
		'Alimentation des signets du doc - partie Initial 
		objDocument.Bookmarks("olfDateCfNi").Range.Text = strCflowDateNI1 
		objDocument.Bookmarks("olfPymtConv_x").Range.Text = strCflowPymtConvNI1
		objDocument.Bookmarks("olfDevCfIntBuNI").Range.Text = strCflowCcyNI1 
		objDocument.Bookmarks("olfMttCfIntBuInit").Range.Text = strolfCflowMntNI1
		objDocument.Bookmarks("olfDevCfExtBuNI").Range.Text = strCflowCcyNI2 
		objDocument.Bookmarks("olfMttCfExtBuInit").Range.Text = strolfCflowMntNI2 
		'Alimentation des signets du doc - partie Final 
		objDocument.Bookmarks("olfDateCfNF").Range.Text = strCflowDateFI1 
		objDocument.Bookmarks("olfPymtConv_xx").Range.Text = strCflowPymtConvFI1
		objDocument.Bookmarks("olfDevCfIntBuFin").Range.Text = strCflowCcyFI1
		objDocument.Bookmarks("olfMttCfIntBuFin").Range.Text = strolfCflowMntFI1
		objDocument.Bookmarks("olfDevCfExtBuFin").Range.Text = strCflowCcyFI2
		objDocument.Bookmarks("olfMttCfExtBuFin").Range.Text = strolfCflowMntFI2


		
		' alimentation strolfNtlHolShd
		strolfNtlHolShd = OLF_GetField("olfNotnlHol")
		objDocument.Bookmarks("olfHolSched_x").Range.Text = strolfNtlHolShd

      End If
End If
'End_ref22

'Begin_ref55 and Begin_ref56 --DEK--
If (strAgrtType = "ISDA" and UCase(strPricingModel)= "FXDIGIT") Then
	'suppression du bloc olfFXDigitBloc
	objDocument.Bookmarks("olfFXDigitBloc").Select
	objApplication.Selection.Delete
	'suppression du bloc olf2ZonesBloc3
	objDocument.Bookmarks("olf2ZonesBloc3").Select
	objApplication.Selection.Delete
	objApplication.Selection.TypeBackspace
	'suppression du bloc olf2ZonesBloc4
	objDocument.Bookmarks("olf2ZonesBloc4").Select
	objApplication.Selection.Delete
	'objApplication.Selection.TypeBackspace
ElseIf (strAgrtType = "ISDA" and UCase(strPricingModel)= "FXFLOATER") Then  '--DEK ref 56 2Zones--
	'suppression du bloc olf2ZonesBloc1
	objDocument.Bookmarks("olf2ZonesBloc1").Select
	objApplication.Selection.Delete
	objApplication.Selection.TypeBackspace
	'suppression du bloc olf2ZonesBloc2
	objDocument.Bookmarks("olf2ZonesBloc2").Select
	objApplication.Selection.Delete
	objApplication.Selection.TypeBackspace
	objApplication.Selection.TypeBackspace
	'suppression du bloc olf2ZonesBloc5
	objDocument.Bookmarks("olf2ZonesBloc5").Select
	objApplication.Selection.Delete
	objApplication.Selection.TypeBackspace
ElseIf (strAgrtType = "ISDA" and UCase(strReference)= "DUAL") Then
	'suppression du bloc olf2ZonesBloc3
	objDocument.Bookmarks("olf2ZonesBloc3").Select
	objApplication.Selection.Delete
	objApplication.Selection.TypeBackspace
	'suppression du bloc olf2ZonesBloc4
	objDocument.Bookmarks("olf2ZonesBloc4").Select
	objApplication.Selection.Delete
	'objApplication.Selection.TypeBackspace
End If
'End_ref55 and End_ref56

'begin_ref51
If (Ucase(Cd_rgpt_str) = "TFAINF" Or Ucase(Cd_rgpt_str) = "TEAINF") Then
	'suppression du bloc de l'introduction
	objDocument.Bookmarks("olfIntroInflation").Select
	objApplication.Selection.Delete

	If (Ucase(Cd_rgpt_str) = "TFAINF") then
		objDocument.Bookmarks("olfInflBloc1").Select
		objApplication.Selection.Delete
		objDocument.Bookmarks("olfInflBloc2").Select
		objApplication.Selection.Delete
		objDocument.Bookmarks("olfRelevantBloc").Select
		objApplication.Selection.Delete
	End IF

	If (strolfResetConv2 = "0") then
		objDocument.Bookmarks("olfInArrearsBloc").Select
		objApplication.Selection.Delete
		objDocument.Bookmarks("olfInArrearsBloc_1").Select
		objApplication.Selection.Delete
	End IF

	If (strolfResetConv2 = "1") then
		objDocument.Bookmarks("olfNormalBloc").Select
		objApplication.Selection.Delete
		objDocument.Bookmarks("olfNormalBloc_1").Select
		objApplication.Selection.Delete
	End IF
End if

'end_ref51

'Thomas
    If (Ucase(strReference) <> "LOBO" And strAgrtType <> "AFB") Then 
'fin Thomas
      
    	strTerminationDate = strLblTermAdjDate + "; (ii) unadjusted " +  strLblTermNonAdjDate
		If (strLblTermAdjDate > " " And strLblTermNonAdjDate > " ") Then
      	      'If (Ucase(strReference) = "OPTIMA") Then -- DCH
               If (Ucase(strReference) <> "DUAL" And Ucase(strReference) <> "DIGICMS" And Ucase(strReference) <> "FIXMS" And Ucase(strReference) <> "DIGISWISS" And Ucase(strReference) <> "DIGIFIX" And Ucase(strPricingModel) <> "FXFLOATER") Then	
			If (StrFlagOpt = "1") Then
                		strTerminationDate = strTerminationDate + "; (iii) the provisions of Section 3 of this Confirmation"
            	End If
		   End If
			Call DOC_SetField(objDocument,"AddText4Adjust", strTerminationDate)
		ElseIf (strUnadA = "N" And strUnadB = "N") Then
            	'If (Ucase(strReference) = "OPTIMA") Then -- DCH
			If (StrFlagOpt = "1") Then
	               If (Ucase(strReference) <> "DUAL" And Ucase(strReference) <> "DIGICMS" And Ucase(strReference) <> "FIXMS" And Ucase(strReference) <> "DIGISWISS" And Ucase(strReference) <> "DIGIFIX" And Ucase(strPricingModel) <> "FXFLOATER") Then	
                		strTerminationDate = " and (ii) the provisions of Section 3 of this Confirmation"
                		Call DOC_SetField(objDocument,"AddText4Adjust", strTerminationDate)
			   Else
				objDocument.Bookmarks("DelTermAdj").Range.Text = ""
			   End If
            	Else
                		objDocument.Bookmarks("DelTermAdj").Range.Text = ""
            	End If
      	Else
            	'If (Ucase(strReference) = "OPTIMA") Then
			If (StrFlagOpt = "1") then 
			   If (Ucase(strReference) <> "DUAL" And Ucase(strReference) <> "DIGICMS" And Ucase(strReference) <> "FIXMS" And Ucase(strReference) <> "DIGISWISS" And Ucase(strReference) <> "DIGIFIX" And Ucase(strPricingModel) <> "FXFLOATER") Then	
                		strTerminationDate = " subject to the provisions of Section 3 of this Confirmation"
                		Call DOC_SetField(objDocument,"AddText4Adjust", strTerminationDate)
			   End If
            	End If
		End If

    	If (NumFxAdjAmnt> "" ) Then 
    		NumFxAdjAmnt = "for Fixed Amount " + NumFxAdjAmnt 
	End If
    	If (NumFltAdjAmnt> "" ) Then 
    		NumFltAdjAmnt= "for Floating Amount " + NumFltAdjAmnt
	    	If (NumFxAdjAmnt> "" ) Then 
	    		NumFxAdjAmnt = " and " + NumFxAdjAmnt
		End If 
	End If


	If  ( NumFltAdjAmnt> "" Or NumFxAdjAmnt > "") Then	
      	Call DOC_SetField(objDocument,"AddAdjLeg", NumFltAdjAmnt + NumFxAdjAmnt)
	End If
    	If (NumFxNonAdjAmnt> "" ) Then 
    		NumFxNonAdjAmnt = "for Fixed Amount " + NumFxNonAdjAmnt 
	End If
    	If (NumFltNonAdjAmnt> "" ) Then 
    		NumFltNonAdjAmnt= "for Floating Amount " + NumFltNonAdjAmnt
	    	If (NumFxNonAdjAmnt> "" ) Then 
	    		NumFxNonAdjAmnt = " and " + NumFxNonAdjAmnt
		End If 
	End If

	If  ( NumFltNonAdjAmnt> "" Or NumFxNonAdjAmnt > "") Then	
      	Call DOC_SetField(objDocument,"AddUnadLeg", NumFltNonAdjAmnt + NumFxNonAdjAmnt)
	Else
		objDocument.Bookmarks("DelNonAdjLeg").Range.Text = ""
            Call DOC_SetField(objDocument,"AddAdjLeg", "")

	End If
	If (intAllLegUnad = 0) Then
		objDocument.Bookmarks("DelAdjLeg").Range.Text = ""
	End If
    Elseif (Ucase(strReference) = "LOBO" And strAgrtType <> "AFB") Then
	  Call DOC_SetField(objDocument,"AddText4Adjust", "and (ii) the provisions of Section 3 of this Confirmation")
    End If

'    If CptFix <= 0 Then
'    	Call DOC_SetField(objDocument,"NumFltAmnt", NumFltAmnt)
'    ElseIf	strAgrtType = "AFB" Then
'    	Call DOC_SetField(objDocument,"NumFltAmnt", NumFltAmnt + " et Montants Fixes " + NumFxAmnt)
'    Else 
'	Call DOC_SetField(objDocument,"NumFltAmnt", NumFltAmnt + " and Fixed Amounts " + NumFxAmnt)
'    End If

    If strAgrtType = "ISDA" And strolfInsType = "CSC" or strolfInsType = "CSC-B" or strolfInsType = "ST-CSC" Then

      For i=1 to NbLeg-1
    		If CptFix <= 0 Then
		    	Call DOC_SetField(objDocument,"NumFltAmnt" & i, NumFltAmnt)
        	Else 
			Call DOC_SetField(objDocument,"NumFltAmnt" & i, NumFltAmnt + " and Fixed Amounts " + NumFxAmnt)
    		End If
		If  ( NumFltAdjAmnt> "" Or NumFxAdjAmnt > "") Then	
		      	Call DOC_SetField(objDocument,"AddAdjLeg" & i, NumFltAdjAmnt + NumFxAdjAmnt)
		End If
		If  ( NumFltNonAdjAmnt> "" Or NumFxNonAdjAmnt > "") Then	
	      		Call DOC_SetField(objDocument,"AddUnadLeg" & i, NumFltNonAdjAmnt + NumFxNonAdjAmnt)
		Else
			objDocument.Bookmarks("DelNonAdjLeg_" & i).Range.Text = ""
      		      	Call DOC_SetField(objDocument,"AddAdjLeg" & i, "")
		End If
		
		If (intAllLegUnad = 0) Then
			objDocument.Bookmarks("DelAdjLeg_" & i).Range.Text = ""
		End If
    	Next
    End If
End Sub


'---------------------------------------------------------------------------------------
'////////////////////////////////////////////////////////////////////////////////////////
'Name:          DOC_SetField(ByRef objDoc, ByVal strDocFieldName, ByVal strDocFieldValue)
'
'Description:   Sets a particular data or value to a given field in Word document.
'
'Parameters:    strDocFieldName  (IN)   -  a given field in Word document.
'               strDocFieldValue (IN)   -  a value;
'                                       -  If the value is a Table format in Endur,
'                                        it will be automatically convert to
'                                    Visual Basic format.
'
'Returns:       NONE
'
'Date of Last Revisition:   Feb 22, 2002
'//////////////////////////////////////////////////////////////////////////////////////
Sub DOC_SetField(ByRef objDoc, ByVal strDocFieldName, ByVal strDocFieldValue)

    on error resume next 

    strDocFieldName = Trim(strDocFieldName)

    '//find Table value in Endur and convert it to VB value
    If InStr(1, strDocFieldValue, vbLf) <> 0 Then
        strDocFieldValue = Replace(strDocFieldValue, vbLf, vbCr)
    End If

    objDoc.FormFields(strDocFieldName).Result = strDocFieldValue

End Sub

'---------------------------------------------------------------------------------------
'////////////////////////////////////////////////////////////////////////////////////////
'Name:          OLF_GetField(ByVal strFieldNameFromEndur)
'
'Description:   Retrieves a particular data or value from the Message store
'               for a given field.
'
'Parameters:    strFieldNameFromEndur (IN)  -  Field name from the Message store to
'                                retrieve the value for.
'
'Returns:       If the field name exists, returns the value it retrieves from Message store.
'               If the field name does not exist, returns an empty string ("")
'
'Date of Last Revisition:   Feb 22, 2002
'//////////////////////////////////////////////////////////////////////////////////////
Function OLF_GetField(ByVal strFieldNameFromEndur)

    strFieldNameFromEndur = Trim(strFieldNameFromEndur)
    If strFieldNameFromEndur <> "" Then
        OLF_GetField = Item.UserProperties.Find(strFieldNameFromEndur)
    Else
        OLF_GetField = ""
    End If

End Function

'---------------------------------------------------------------------------------------
'////////////////////////////////////////////////////////////////////////////////////////
'Name:          DOC_Close(ByRef objApplication, ByRef objDocument)
'
'Description:   This function closes a Word document, destroys its objects, and send
'               confirmation status ("olfConfStatus") back to the message store.
'
'Parameters:    objApplication (IN/OUT)   - the Word Application object
'               objDocument (IN/OUT)     -  the Word Document object
'
'Returns:       TRUE    -   if no errors occurred
'               FALSE   -   if any errors occurred
'
'Date of Last Revisition:   Feb 25, 2002
'//////////////////////////////////////////////////////////////////////////////////////
Function DOC_Close(ByRef objApplication, ByRef objDocument)
    on error Resume Next
    Err.Clear

    '//Exit if object no longer exist;
    '//or object never be created.
    If IsExist(objApplication) = False Or IsExist(objDocument) = False Then

          If IsExist(objDocument) = True Then
            Call Object_Destroy(objDocument)
      End If

      If IsExist(objApplication) = True Then
            Call Object_Destroy(objApplication)
        End If

        Exit Function
    End If

    '//Save status back to the Message store.
    If OLF_Update(objDocument) = False Then
        MsgBox "Unable to save Status " & Chr(34) & "olfConfStatus" & Chr(34) & _
            " back to Outlook/Exchange! " & _
            vbCrLf & "Word Document may have been closed already.", _
            vbCritical, _
            "Error: Failed To Save Status."
    End If

    '//Show message if error occurs
    'Call OnErrorShowMessage()
        
    ' Close and don't save changes to the document
    Const wdDoNotSaveChanges = 0
    objDocument.Close wdDoNotSaveChanges

    '//Close Word Application instance
    objApplication.Quit

    '//Clean up
    Call Object_Destroy(objApplication)
    Call Object_Destroy(objDocument)

    DOC_Close = True
End Function


'---------------------------------------------------------------------------------------
'////////////////////////////////////////////////////////////////////////////////////////
'Name:          OLF_Update(ByRef objDocument)
'
'Description:   Update olfConfStatus and olfUpdateConf in Exchange (Message store)
'               When modifying this function, please reference to outbound_doc_status
'           database table.
'
'Parameters:    objDocument (IN)   -  the Word Document object
'
'Returns:       TRUE    -   if no errors occurred
'               FALSE   -   if any errors occurred
'
'Date of Last Revisition:   Feb 25, 2002
'//////////////////////////////////////////////////////////////////////////////////////
Function OLF_Update(ByRef objDocument)

    Dim dblCurrentStatus, dblPreviousStatus
    Dim intDOCCurrentConfStatus
    Dim dblOLFPreviousStatus

    intDOCCurrentConfStatus = objDocument.FormFields("olfConfStatus").DropDown.Value
      

    Select Case intDOCCurrentConfStatus
        Case 1
            dblCurrentStatus = 3
        Case 2, 3, 4, 5, 6, 7, 8
          dblCurrentStatus = intDOCCurrentConfStatus + 3
        Case Else
            dblCurrentStatus = -1
    End Select

    dblPreviousStatus = OLF_GetField("olfConfStatus")
 
    '//if new document has been generated and confirmation status
    '//has not been change, exit and do nothing
    If dblPreviousStatus = 0 And dblCurrentStatus = 3 Then
      OLF_Update = True
        Exit Function
    End If

    If dblCurrentStatus > 0 Then
    
        '//if nothing changed, exit fucntion
        If dblPreviousStatus = dblCurrentStatus Then
            OLF_Update = True
        Else
            '//update olfConfStatus
            Item.UserProperties.Find("olfConfStatus") = dblCurrentStatus

            '//set olfUpdateConf to 1 so that Endur can correctly
            '//update the confirmation status.
            Item.UserProperties.Find("olfUpdateConf") = 1
        
            OLF_Update = True
        End If
    Else
        OLF_Update = False
    End If
End Function


'---------------------------------------------------------------------------------------
'////////////////////////////////////////////////////////////////////////////////////////
'Name:          DOC_SetStatus(ByRef objDocument)
'
'Description:   Set "olfConfStatus" value in Word document
'               When modifying this function, please reference to outbound_doc_status
'           database table.
'
'Parameters:    objDocument (IN)   -  the Word Document object
'
'Returns:       TRUE    -   if no errors occurred
'               FALSE   -   if any errors occurred
'
'Date of Last Revisition:   Feb 25, 2002
'//////////////////////////////////////////////////////////////////////////////////////
Function DOC_SetStatus(ByRef objDocument)
    Dim dblConStatus
    Dim intOLFConfStatus
    Dim intDOCConfStatus
    
    dblConStatus = OLF_GetField("olfConfStatus")

    '//if olfConfStatus exists, coverts it to integer
    '//exit if unable to find olfConfStatus
    If IsExist(dblConStatus) = True Then
          intOLFConfStatus = CInt(dblConStatus)
    Else
      DOC_SetStatus = False
      Exit Function
    End If

    '//Adjust value since drop-down list starts at index 1
  
    Select Case intOLFConfStatus
         Case 0, 3
            intDOCConfStatus = 1
         Case 5, 6, 7, 8, 9, 10, 11
            intDOCConfStatus = intOLFConfStatus - 3
         Case Else
            intDOCConfStatus = -1
    End Select


    '//set confirmation status in Word document
    If intDOCConfStatus > 0 Then
        objDocument.FormFields("olfConfStatus").DropDown.Value = intDOCConfStatus
        DOC_SetStatus = True
    Else
        DOC_SetStatus = False
    End If

End Function


'---------------------------------------------------------------------------------------
'////////////////////////////////////////////////////////////////////////////////////////
'Name:          OnErrorShowMessage()
'
'Description:   Show error description for debugging
'
'Parameters:    objDocument (IN)   -  the Word Document object
'
'Returns:       TRUE    -   if no errors occurred
'               FALSE   -   if any errors occurred
'
'Date of Last Revisition:   Feb 25, 2002
'//////////////////////////////////////////////////////////////////////////////////////
Function OnErrorShowMessage()
    If Err.Number <> 0 Then

        Dim strMsg
        strMsg = Err.Description
        strMsg = strMsg & vbCrLf & "Click OK to Exit..."

        MsgBox strMsg, vbCritical, "Error: Unable to continue..."

        OnErrorShowMessage = True
    Else
        OnErrorShowMessage = False
    End If
End Function


'---------------------------------------------------------------------------------------
'////////////////////////////////////////////////////////////////////////////////////////
'Name:          Object_Destroy(ByRef objectName)
'
'Description:   Destroy the object if it exists
'
'Parameters:    objectName(OUT)   -  the object name
'
'Returns:       NONE
'
'Date of Last Revisition:   Feb 25, 2002
'//////////////////////////////////////////////////////////////////////////////////////
Sub Object_Destroy(ByRef objectName)
    If TypeName(objectName) <> "" Then
        Set objectName = Nothing
    End If
End Sub

 
'---------------------------------------------------------------------------------------
'////////////////////////////////////////////////////////////////////////////////////////
'Name:          FORM_Initialize(ByVal strCurrentPageName)
'
'Description:   Sets strCurrentPageName as the initial page, and hides "Message" page.
'               NOTICE: If the user does not use "Display This Page" in Form menu to set
'               page to be display, by default, the current page is P.2 and it
'               will not show on run-time.
'
'Parameters:    strCurrentPageName (IN)   - Name of current page.
'                                         - By default, it is "P.2"
'
'Returns:       NONE
'
'Date of Last Revisition:   Feb 25, 2002
'////////////////////////////////////////////////////////////////////////////////////////
Sub FORM_Initialize(ByVal strCurrentPageName)

    strCurrentPageName = Trim(strCurrentPageName)
    
    '//set default value to "P.2" to empty
    If strCurrentPageName = "" Then
        strPageName = "P.2"
    End If
    
    Item.GetInspector.SetCurrentFormPage strCurrentPageName
    Item.GetInspector.ShowFormPage strCurrentPageName
    Item.GetInspector.HideFormPage "Message"
End Sub
'------------------------------------------------------------------------------------------------
 

'///////////////////////////////////////////////////////////////////////////////////////////////
'Name:          DOC_HideSection(ByRef objApplication, ByRef strRangeStart, ByRef strRangeEnd)
'
'Description:   Hides the section within a particular range.
'
'Parameters:    objApplication (IN)   - the Word Application object.
'               strRangeStart (IN)  - formfield name representing the start of the range.
'               strRangeEnd (IN)    - formfield name representing the end of the range.
'
'Returns:       TRUE    -   if no errors occurred
'               FALSE   -   if any errors occurred
'
'Date of Last Revisition:   Feb 25, 2002
'/////////////////////////////////////////////////////////////////////////////////////////////////
Function DOC_HideSection(ByRef objApplication, ByRef strRangeStart, ByRef strRangeEnd)
    '//You can define the range by using a bookmark.  This can allow us
    '//to select a bookmark and hide the data subsequent to it.

    Dim intStart, intEnd, objRange

    intStart = objApplication.ActiveDocument.Bookmarks.Item(strRangeStart).Start - 1
    intEnd = objApplication.ActiveDocument.Bookmarks.Item(strRangeEnd).End + 1

    Set objRange = objApplication.ActiveDocument.Range(intStart, intEnd)


    If IsExist(objRange) = False Then
        MsgBox "Unable to set range: " & strSessionStart & " - " & strSessionEnd, vbCritical, "Error"
        DOC_HideSection = False
        Exit Function
    End If
 
    objRange.Delete

    Call Object_Destroy(objRange)

    DOC_HideSection = True
End Function



'------------------------------------------------------------------------------------------------
'////////////////////////////////////////////////////////////////////////////////////////////////
'Name:          DOC_HideFieldByPrefix(ByRef objApplication, ByRef strPrefix)
'
'Description:   Hide/Delete Fields in Word document by field's prefix
'               Notes: For debugging, use objApplication.ActiveDocument.Bookmarks.Count
'               to count number of bookmarks / formfields
'
'Parameters:    objApplication (IN)   - the Word Application object
'               strPrefix (IN)  - formfield prefix name
'
'Returns:       TRUE    -   if no errors occurred
'               FALSE   -   if any errors occurred
'
'Date of Last Revisition:   Feb 25, 2002
'/////////////////////////////////////////////////////////////////////////////////////////////////
Sub DOC_HideFieldByPrefix(ByRef objApplication, ByVal strPrefix)

    strPrefix = Trim(strPrefix)

    '//exits if prefix name in parameter is a empty string
    If strPrefix = "" Then
        Exit Sub
    End If

    Dim strName
    strName = ""
    '//hide any field if its prefix name = strPrefix
    For Each aBookmark In objApplication.ActiveDocument.Bookmarks
            If Left(aBookmark.Name, Len(strPrefix)) = strPrefix Then
                If DOC_HideSection(objApplication, aBookmark.Name, aBookmark.Name) = False Then
                    strName = strName & " "
                End If
        End If
    Next
    
    If Trim(strName) <> "" Then
        MsgBox "Unable to hide " & strName, vbCritical, "Unable to hide..."
    End If
    
End Sub
  
    
'---------------------------------------------------------------------------------------
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////
'Name:          DOC_SetLongCharsField(ByRef objApp, ByRef objDoc, ByVal strDocFieldName, ByVal strDocFieldValue)
'
'Description:   same functionalities as DOC_SetField() but for long characters only
'
'Parameters:    objApp           (IN)   - the Word Application object.
'               objDoc           (IN)   - the Word Document object.
'               strDocFieldName  (IN)   -  a given field in Word document.
'               strDocFieldValue (IN)   -  a value;
'                                       -  If the value is a Table format in Endur,
'                                        it will be automatically convert to
'                                        Visual Basic format.
'
'Returns:       NONE
'
'Date of Last Revisition:   Sep 6, 2002
'///////////////////////////////////////////////////////////////////////////////////////////////////////////////
Sub DOC_SetLongCharsField(ByRef objApp, ByRef objDoc, ByVal strDocFieldName, ByVal strDocFieldValue)

    on error resume next

    strDocFieldName = Trim(strDocFieldName)

    '//find Table value in Endur and convert it to VB value
    If InStr(1, strDocFieldValue, vbLf) <> 0 Then
        strDocFieldValue = Replace(strDocFieldValue, vbLf, vbCr)
    End If

    '//objDoc.FormFields(strDocFieldName).Result = strDocFieldValue
    objDoc.FormFields(strDocFieldName).Range.Select
    objApp.Selection.Range.Text = strDocFieldValue
End Sub


    

'---------------------------------------------------------------------------------------
'////////////////////////////////////////////////////////////////////////////////////////
'Name:          DOC_SetConditionalData(ByRef objDocument)
'
'Description:   This function sets all the fields that require a special formula/condition.
'
'Parameters:    objDocument (IN)  -  Word Document object
'
'Returns:       NONE
'
'Date of Last Revisition: Sep 27, 2002
'//////////////////////////////////////////////////////////////////////////////////////
Sub DOC_SetConditionalData(ByRef objDocument)

    Dim StrFieldBroker
    Dim strAmort
    Dim strAgrtType 
    Dim strIntLent
    Dim strExtBU
    Dim strIntInter
    Dim strExtInter
    Dim strExtBUSht
    Dim strUnadA
    Dim strUnadB
    Dim strReference
    Dim strPricingModel
    Dim StrFlagOpt
    Dim strolfInsType
    Dim strStrike
    Dim strBuySell

    on error resume next	

    strPricingModel= OLF_GetField("olfPricingModel")
    strReference = OLF_GetField("olfReference")
    strIntLent = OLF_GetField("olfIntLentLngName")
    strExtBU = OLF_GetField("olfExtBULongName")
    strExtBUSht = OLF_GetField("olfExtBUShortName")
    StrFlagOpt = OLF_GetField("opt1")
    strBuySell = OLF_GetField("opt1")
   
    'MsgBox("strPricingModel : '" & strPricingModel & "' ")
    'MsgBox("olfOptStyle : '" & olfOptStyle & "' ")	
    
    strolfInsType = OLF_GetField("olfInsType")
    strStrike = OLF_GetField("olfStrike")


    If (UCase(strolfInsType) <> "CAP" And UCase(strolfInsType) <> "FLR") then	' DCH, ajout pour la prise en compte OPTION
    	StrFieldBroker=OLF_GetField("olfBrokerId")
    	If (StrFieldBroker= "DEALING" Or UCase(StrFieldBroker)= "NONE" )Then
		Call DOC_SetField(objDocument,"olfLblBrokerId_1","")
		Call DOC_SetField(objDocument,"olfBrokerId_1","")
	End If
    End if

    If (UCase(strolfInsType) = "CAP" Or UCase(strolfInsType) = "FLR") then	' DCH, ajout pour la prise en compte OPTION
		'Call DOC_SetField(objDocument,"olfStrike",strStrike)
		Call DOC_SetField(objDocument, "olfCapRate", 		OLF_GetField("olfStrike"))
		'gestion du fixed et floatint rate payer
		strBuySell = OLF_GetField("olfBuySell")

		'If strBuySell = "Sell" Then
			'Call DOC_SetField(objDocument,"olfFxRatePayer",strExtBU)
			'Call DOC_SetField(objDocument,"olfFltRatePayer",strIntLent)
		'Else
			'Call DOC_SetField(objDocument,"olfFxRatePayer",strIntLent)
			'Call DOC_SetField(objDocument,"olfFltRatePayer",strExtBU)
		'End If


		
		'libelle du rate
		If UCase(strolfInsType) = "CAP" Then
			Call DOC_SetField(objDocument,"olfLibRate","Cap Rate")
		Else
			Call DOC_SetField(objDocument,"olfLibRate","Floor Rate")
		End If
    End If

    strAmort = OLF_GetField("olfAmort")
    strAgrtType = OLF_GetField("olfAgrtType")
    If (UCase(strAmort )= "O" And UCase(strAgrtType)= "AFB") Then 
		Call DOC_SetField(objDocument,"olfAmort","Soumis à amortissement tel que défini en Annexe ci-joint")
    ElseIf (UCase(strAmort )= "O" And UCase(strAgrtType)= "ISDA") Then
		Call DOC_SetField(objDocument,"olfAmort","Subject to the Amortization Schedule attached hereto")
    Else            
		Call DOC_SetField(objDocument,"olfAmort","")
    End If

    strIntInter = OLF_GetField("olfIntInterName")
    If (strIntInter > " ") Then
	'If (UCase(strolfInsType) <> "CAP" And UCase(strolfInsType) <> "FLR") then	
        Call DOC_SetField(objDocument, "FTAIntBUName", 		OLF_GetField("olfIntLent"))
	'End If 
      'Call DOC_SetField(objDocument, "olfIntLentLngName_5", 	OLF_GetField("olfIntSetBnkLngName"))
      'Call DOC_SetField(objDocument, "olfIntSetBnkLngName", 	OLF_GetField("olfIntInterName"))
      'Call DOC_SetField(objDocument, "olfIntSetBnkShtName", 	OLF_GetField("olfIntInterBic"))
    End If

    strExtInter = OLF_GetField("olfExtInterName")

    If (strExtInter > " ") Then
	'If (UCase(strolfInsType) <> "CAP" And UCase(strolfInsType) <> "FLR") then	
	  Call DOC_SetField(objDocument, "FTAExtBUName", 		OLF_GetField("olfExtBULongName"))
	'End If
      'Call DOC_SetField(objDocument, "olfExtBULongName_7", 	OLF_GetField("olfExtSetBnkLngName")) 
      'Call DOC_SetField(objDocument, "olfExtSetBnkLngName", 	OLF_GetField("olfExtInterName"))
      'Call DOC_SetField(objDocument, "olfExtSetBnkShtName", 	OLF_GetField("olfExtInterBic"))
    End If
    
    ' stop
    strAmort = OLF_GetField("olfAmort")
    strAgrtType = OLF_GetField("olfAgrtType")
    If (UCase(strAmort )= "O" And UCase(strAgrtType)= "AFB") Then 
		Call DOC_SetField(objDocument,"olfAmort","Soumis à amortissement tel que défini en Annexe ci-joint")
    ElseIf (UCase(strAmort )= "O" And UCase(strAgrtType)= "ISDA") Then
		Call DOC_SetField(objDocument,"olfAmort","Subject to the Amortization Schedule attached hereto")
		
    Else
		if (UCase(strolfInsType) <> "CAP" And UCase(strolfInsType) <> "FLR") then	' DCH, ajout pour la prise en compte OPTION
			Call DOC_SetField(objDocument,"olfAmort","")
      		objDocument.Bookmarks("olfRemAmort").Range.Text = "" 
		End If
    End If

    if (UCase(strExtBUSht)= "DPPFGB2LNSW" Or UCase(strExtBUSht)= "CROPITRRXXX" Or UCase(strExtBUSht)= "DXIADEBBXXX" Or UCase(strExtBUSht)= "DSBLESM1XXX" Or UCase(strExtBUSht)= "DPPFGB2LNSW" Or UCase(strExtBUSht)= "DPPFSESSNSW") Then
		 Call DOC_SetField(objDocument,"olfExtLentLngName_50",strIntLent)
    End If

    If (UCase(strPricingModel) = "FLEXI" And UCase(OLF_GetField("olfOptHolList")) = "TARGET") Then
        Call DOC_SetField(objDocument,"olfOptHolList","TARGET Settlement Days")
	  'DCH, 24/11/2006 Ref 60.
	  'on force ces champs là à "Brussels" seulement pour ce cas après l'autopopulate.
	  Call DOC_SetField(objDocument,"olfOptHolList_1","Brussels")
        Call DOC_SetField(objDocument,"olfOptHolList_2","Brussels")
    End If

    If (UCase(strPricingModel) = "FLEXI" And UCase(OLF_GetField("olfOptStyle")) <> "BERMUDA") Then
		objDocument.Bookmarks("DelTermDate").Range.Text = "" 
      	objDocument.Bookmarks("DelExpDate").Range.Text = "" 
		objDocument.Bookmarks("DelOptDate1").Range.Text = "" 
		objDocument.Bookmarks("DelOptDate2").Range.Text = "" 
    End If

    If (Ucase(strReference) = "FIXMS" or Ucase(strReference) = "DIGICMS" or Ucase(strReference) = "DUAL" or UCase(strPricingModel)= "FXDIGIT" Or UCase(strPricingModel)= "FXFLOATER") Then
	If (Ucase(StrFlagOpt) = "1") then
		If (OLF_GetField("olfOptHolList") = "TARGET") Then
			Call DOC_SetField(objDocument,"olfOptHolList","TARGET Settlement Days")
			Call DOC_SetField(objDocument,"olfOptHolList_1","Brussels")
        		Call DOC_SetField(objDocument,"olfOptHolList_2","Brussels")
		ELSE
			Call DOC_SetField(objDocument,"olfOptHolList",strolfOptHolList)
			Call DOC_SetField(objDocument,"olfOptHolList_1",strolfOptHolList_1)
        		Call DOC_SetField(objDocument,"olfOptHolList_2",strolfOptHolList_2)
		End If	
	End If
     End If	

End Sub
'----------------------------------------------------------------------------------------

Sub DOC_PopulateSWT(ByRef objApp, ByRef objDocument, ByRef NodeName, ByRef TextValue, ByRef Cpt, ByRef strPeriod, ByRef strFxFlt, ByRef strCte1, ByRef strMonoPeriod, ByRef strRstShift, ByRef Cd_rgpt_str)

 Dim strAgrtType
 Dim strPricingModel 
 Dim strReference

 strAgrtType = OLF_GetField("olfAgrtType")
 strPricingModel = OLF_GetField("olfPricingModel")
' Seb - 17/08/2005
 strReference = OLF_GetField("olfReference")

    If ((UCase(strReference)="FIXMS" or UCase(strReference)="DIGICMS") And strCte1 <> "" And objDocument.Bookmarks(nodeName) = "olfIndexTenorCourt") Then

        objDocument.Bookmarks("olfIndexTenorCourt").Select
        objApp.Selection.Text = TextValue
        objDocument.Bookmarks("olfIndexTenorCourt_bis").Select
        objApp.Selection.Text = TextValue
        If UCase(strReference)<>"DIGICMS" then
		objDocument.Bookmarks("olfIndexTenorCourt_ter").Select
		objApp.Selection.Text = TextValue
        End If
        objDocument.Bookmarks("olfIndexTenorCourt_qua").Select
        objApp.Selection.Text = TextValue

    ElseIf ((UCase(strReference)="FIXMS" or UCase(strReference)="DIGICMS") And strCte1 <> "" And objDocument.Bookmarks(nodeName) = "olfIndexTenor1") Then

        objDocument.Bookmarks("olfIndexTenor1").Select
        objApp.Selection.Text = TextValue
        objDocument.Bookmarks("olfIndexTenor1_bis").Select
        objApp.Selection.Text = TextValue
        If UCase(strReference)<>"DIGICMS" then
        	objDocument.Bookmarks("olfIndexTenor1_ter").Select
        	objApp.Selection.Text = TextValue
        End If
        objDocument.Bookmarks("olfIndexTenor1_qua").Select
        objApp.Selection.Text = TextValue

    ElseIf ((UCase(strReference)="FIXMS" or UCase(strReference)="DIGICMS") And strCte1 <> "" And objDocument.Bookmarks(nodeName) = "olfIndexMeans") Then

        objDocument.Bookmarks("olfIndexMeans").Select
        objApp.Selection.Text = TextValue
        objDocument.Bookmarks("olfIndexMeans_bis").Select
        objApp.Selection.Text = TextValue

    ElseIf ((UCase(strReference)="FIXMS" or UCase(strReference)="DIGICMS") And strCte1 <> "" And objDocument.Bookmarks(nodeName) = "olfPublishedOn") Then

        objDocument.Bookmarks("olfPublishedOn").Select
        objApp.Selection.Text = TextValue
        objDocument.Bookmarks("olfPublishedOn_bis").Select
        objApp.Selection.Text = TextValue

    ElseIf ((UCase(strReference)="FIXMS" or UCase(strReference)="DIGICMS") And strCte1 <> "" And objDocument.Bookmarks(nodeName) = "olfRstHolSchdIdx2") Then

        objDocument.Bookmarks("olfRstHolSchdIdx2").Select
        objApp.Selection.Text = TextValue
        objDocument.Bookmarks("olfRstHolSchdIdx2_bis").Select
        objApp.Selection.Text = TextValue
        objDocument.Bookmarks("olfRstHolSchdIdx2_ters").Select
        objApp.Selection.Text = TextValue
    ' DCH Dual
    ElseIf (UCase(strReference)="DUAL" And strCte1 <> "" And objDocument.Bookmarks(nodeName) = "olfDigifixSprd1") Then
	  objDocument.Bookmarks("olfDigifixSprd1").Select
	  objApp.Selection.Text = TextValue

    ElseIf (UCase(strReference)="DUAL" And strCte1 <> "" And objDocument.Bookmarks(nodeName) = "olfDigifixSprd2") Then
	  objDocument.Bookmarks("olfDigifixSprd2").Select
	  objApp.Selection.Text = TextValue
		
    ElseIf (UCase(strReference)="DUAL" And strCte1 <> "" And objDocument.Bookmarks(nodeName) = "olfConstante1") Then
	  objDocument.Bookmarks("olfConstante1").Select
	  objApp.Selection.Text = TextValue
		
    ElseIf (UCase(strReference)="DUAL" And strCte1 <> "" And objDocument.Bookmarks(nodeName) = "olfDigifixFx0") Then
    	  objDocument.Bookmarks("olfDigifixFx0").Select
    	  objApp.Selection.Text = TextValue
	  objDocument.Bookmarks("olfDigifixFx0_1").Select
	  objApp.Selection.Text = TextValue

    ElseIf (UCase(strReference)="DUAL" And strCte1 <> "" And objDocument.Bookmarks(nodeName) = "olfResetShift2") Then
	  objDocument.Bookmarks("olfResetShift2").Select
	  objApp.Selection.Text = TextValue

    ElseIf (UCase(strPricingModel)= "FXFLOATER" And strCte1 <> "" And objDocument.Bookmarks(nodeName) = "olfResetShift2") Then
	  objDocument.Bookmarks("olfResetShift2").Select
	  objApp.Selection.Text = TextValue

    ElseIf (UCase(strPricingModel)= "FXDIGIT" And strCte1 <> "" And objDocument.Bookmarks(nodeName) = "olfDigifixSprd1") Then
	  objDocument.Bookmarks("olfDigifixSprd1").Select
	  objApp.Selection.Text = TextValue

    ElseIf (UCase(strPricingModel)= "FXDIGIT" And strCte1 <> "" And objDocument.Bookmarks(nodeName) = "olfDigifixSprd2") Then
	  objDocument.Bookmarks("olfDigifixSprd2").Select
	  objApp.Selection.Text = TextValue
		
    ElseIf (UCase(strPricingModel)= "FXDIGIT" And strCte1 <> "" And objDocument.Bookmarks(nodeName) = "olfConstante1") Then
	  objDocument.Bookmarks("olfDigifixFx0").Select
	  objApp.Selection.Text = TextValue
	  objDocument.Bookmarks("olfDigifixFx0_1").Select
	  objApp.Selection.Text = TextValue
		
    ElseIf (UCase(strPricingModel)= "FXDIGIT"  And strCte1 <> "" And objDocument.Bookmarks(nodeName) = "olfResetShift2") Then
	  objDocument.Bookmarks("olfResetShift2").Select
	  objApp.Selection.Text = TextValue
   					
    ElseIf (UCase(strPricingModel)="OVERTEC" And strCte1 <> "" And objDocument.Bookmarks(nodeName) = "olfRstHolSchdIdx2") Then

        objDocument.Bookmarks("olfRstHolSchdIdx2").Select
        objApp.Selection.Text = TextValue
        objDocument.Bookmarks("olfRstHolSchdIdx2_bis").Select
        objApp.Selection.Text = TextValue

    ElseIf (UCase(strPricingModel)="EXPERTYS" And objDocument.Bookmarks(nodeName) = "olfConstante2") Then
	objDocument.Bookmarks("olfConstante2").Select
	objApp.Selection.Text = TextValue
        objDocument.Bookmarks("olfConstante2_2").Select
        objApp.Selection.Text = TextValue
        objDocument.Bookmarks("olfConstante2_3").Select
        objApp.Selection.Text = TextValue
        objDocument.Bookmarks("olfConstante2_4").Select
        objApp.Selection.Text = TextValue
    
    ElseIf (UCase(strPricingModel)="EXPERTYS" And objDocument.Bookmarks(nodeName) = "olfIndexTenor1") Then
    	objDocument.Bookmarks("olfIndexTenor1").Select
    	objApp.Selection.Text = TextValue
        objDocument.Bookmarks("olfIndexTenor1_2").Select
        objApp.Selection.Text = TextValue
        objDocument.Bookmarks("olfIndexTenor1_3").Select
        objApp.Selection.Text = TextValue
        objDocument.Bookmarks("olfIndexTenor1_4").Select
        objApp.Selection.Text = TextValue
    	objDocument.Bookmarks("olfIndexTenor1_5").Select
    	objApp.Selection.Text = TextValue
    
    ElseIf (UCase(strPricingModel)="EXPERTYS" And objDocument.Bookmarks(nodeName) = "olfIndexTenor2") Then
        objDocument.Bookmarks("olfIndexTenor2").Select
        objApp.Selection.Text = TextValue
        objDocument.Bookmarks("olfIndexTenor2_2").Select
        objApp.Selection.Text = TextValue
        objDocument.Bookmarks("olfIndexTenor2_3").Select
        objApp.Selection.Text = TextValue
        objDocument.Bookmarks("olfIndexTenor2_4").Select
        objApp.Selection.Text = TextValue
    	objDocument.Bookmarks("olfIndexTenor2_5").Select
    	objApp.Selection.Text = TextValue
    	
    ElseIf (UCase(strPricingModel)="EXPERTYS" And objDocument.Bookmarks(nodeName) = "olfFmlaIdx") Then
	objDocument.Bookmarks("olfFmlaIdx").Select
	objApp.Selection.Text = "  " & TextValue
	objDocument.Bookmarks("olfFmlaIdx_2").Select
	objApp.Selection.Text = " " & TextValue
	objDocument.Bookmarks("olfFmlaIdx_3").Select
	objApp.Selection.Text = "  " & TextValue
	objDocument.Bookmarks("olfFmlaIdx_4").Select
	objApp.Selection.Text = "  " & TextValue
    	objDocument.Bookmarks("olfFmlaIdx_5").Select
    	objApp.Selection.Text = TextValue
    	
    ElseIf (UCase(strPricingModel)="EXPERTYS" And objDocument.Bookmarks(nodeName) = "olfFmlaIdx2") Then
    	objDocument.Bookmarks("olfFmlaIdx2").Select
    	objApp.Selection.Text = TextValue
    	objDocument.Bookmarks("olfFmlaIdx2_2").Select
    	objApp.Selection.Text = TextValue
    	objDocument.Bookmarks("olfFmlaIdx2_3").Select
    	objApp.Selection.Text = TextValue
    	objDocument.Bookmarks("olfFmlaIdx2_4").Select
    	objApp.Selection.Text = TextValue
    	objDocument.Bookmarks("olfFmlaIdx2_5").Select
    	objApp.Selection.Text = TextValue
    ' Begin_ref51
    ElseIf ((Ucase(Cd_rgpt_str) = "TFAINF" Or Ucase(Cd_rgpt_str) = "TEAINF") And objDocument.Bookmarks(nodeName) = "olfIdxName") Then
	objDocument.Bookmarks("olfIdxName_1").Select
	objApp.Selection.Text = TextValue
    	objDocument.Bookmarks("olfIdxName_2").Select
    	objApp.Selection.Text = TextValue
    ' End_ref51
    
    ElseIf (objDocument.Bookmarks(nodeName) = "olfPymtConv") Then
            objDocument.Bookmarks("olfPymtConv_1").Select
            objApp.Selection.Text = TextValue
    ElseIf (objDocument.Bookmarks(nodeName) = "olfSide") Then
            objDocument.Bookmarks(nodeName).Select
            objApp.Selection.Text = Cpt
    ElseIf (objDocument.Bookmarks(nodeName) = "olfMonoPeriod" And TextValue="1") Then
		objDocument.Bookmarks("olfMonoPeriod").Select
		objApp.Selection.Text = ""
    ElseIf (objDocument.Bookmarks(nodeName) = "olfMonoPeriod" And TextValue <> "1") Then
		objDocument.Bookmarks("olfMonoPeriod").Delete

    ElseIf (objDocument.Bookmarks(nodeName) = "olfResetShift" And TextValue <> "0") Then
		objDocument.Bookmarks("olfResetShift").Delete
		If (UCase(strPricingModel)="EURIBOROPTIMISE" And strCte1 <> "") Then
 			objDocument.Bookmarks("olfResetShiftIdx2").Delete
		End If

    ElseIf (objDocument.Bookmarks(nodeName) = "olfResetShiftIdx2" And TextValue <> "0") Then 
		objDocument.Bookmarks("olfResetShiftIdx2").Delete

    ElseIf (objDocument.Bookmarks(nodeName) = "olfResetShift" And TextValue = "0") Then
		objDocument.Bookmarks("olfResetShift").Select
		objApp.Selection.Text = ""
		If (UCase(strPricingModel)="EURIBOROPTIMISE" And strCte1 <> "") Then
 			objDocument.Bookmarks("olfResetShiftIdx2").Select
 			objApp.Selection.Text = ""
		End If

    ElseIf (objDocument.Bookmarks(nodeName) = "olfFltSpd" And TextValue = "0,000000") Then
		If (UCase(strAgrtType)= "AFB") Then
			objDocument.Bookmarks("olfFltSpd").Select
			objApp.Selection.Text = "Aucune"
		Else 	
			objDocument.Bookmarks("olfFltSpd").Select
			objApp.Selection.Text = "None"
		End If
    ElseIf (objDocument.Bookmarks(nodeName) = "olfRateInitLblStr" And TextValue <> "None") Then
		objDocument.Bookmarks(nodeName).Select
		objApp.Selection.Text = TextValue
		objDocument.Bookmarks("olfDelPeriod").Delete
    ElseIf (objDocument.Bookmarks(nodeName) = "olfRateInitLblStr" And TextValue = "None") Then
	    	objDocument.Bookmarks("olfDelPeriod").Select
		objApp.Selection.Delete
    ElseIf (objDocument.Bookmarks(nodeName) = "olfRateFinLblStr" And TextValue <> "None") Then
		objDocument.Bookmarks(nodeName).Select
		objApp.Selection.Text = TextValue
		objDocument.Bookmarks("olfDelPeriodFin").Delete
    ElseIf (objDocument.Bookmarks(nodeName) = "olfRateFinLblStr" And TextValue = "None") Then
	    	objDocument.Bookmarks("olfDelPeriodFin").Select
		objApp.Selection.Delete
    ElseIf (objDocument.Bookmarks(nodeName) = "olfLegUnad" And TextValue = "O") Then
	    	objDocument.Bookmarks("olfLegUnad").Select
	    	objApp.Selection.Text = ", with no adjustment to Period End Dates." 
    ElseIf (objDocument.Bookmarks(nodeName) = "olfLegUnad" And TextValue = "N") Then
		objDocument.Bookmarks("olfLegUnad").Delete
    Else
            objDocument.Bookmarks(nodeName).Select
		objApp.Selection.Text=TextValue
    End If    

End Sub

'----------------------------------------------------------------------------------------

Sub DOC_PopulateAFB_FLT(ByRef objApp, ByRef objDocument, ByRef NodeName, ByRef TextValue, ByRef CptVar, ByRef strPeriod, ByRef strPeriod2, ByRef strMonoPeriod, ByRef intFirstLeg)

 Dim strAgrtType
 Dim strPricingModel

 strPricingModel = OLF_GetField("olfPricingModel")
 strAgrtType = OLF_GetField("olfAgrtType")

    If (objDocument.Bookmarks(nodeName) = "olfProjIndex") Then
        Select Case TextValue
               Case "EUR-EURIBOR-Telerate"
                     objDocument.Bookmarks(nodeName).Range.Text = "EUR-EURIBOR-Telerate " + strPeriod + ", soit le taux pour les dépôts " _
                                                                           + "en euros pour une période de " + strPeriod + " tel que publié sur la P" _
                                                                           + "age Telerate 248 à 11h heure de Bruxelles."
               Case "CHF-LIBOR-BBA"
                     objDocument.Bookmarks(nodeName).Range.Text = "CHF-LIBOR-BBA " + strPeriod + ", soit le taux pour les dépôts en Francs" _
                                                                           + " Suisses pour une période de " + strPeriod + " tel que publié sur la Page " _
                                                                           + "Telerate 3750 à 11h heure de Londres."
               Case "GBP-LIBOR-BBA"
                     objDocument.Bookmarks(nodeName).Range.Text = "GBP-LIBOR-BBA " + strPeriod + ", soit le taux pour les dépôts en Sterling " _
                                                                           + " pour une période de " + strPeriod + " tel que publié sur la Page Telerate " _
                                                                           + "3750 à 11h heure de Londres."
               Case "JPY-LIBOR-BBA"
                     objDocument.Bookmarks(nodeName).Range.Text = "JPY-LIBOR-BBA " + strPeriod + ", soit le taux pour les dépôts en Yen pour " _
                                                                           + "une période de " + strPeriod + " tel que publié sur la Page Telerate 3750 " _
                                                                           + "à 11h heure de Londres."
               Case "USD-LIBOR-BBA"
                     objDocument.Bookmarks(nodeName).Range.Text = "USD-LIBOR-BBA " + strPeriod + ", soit le taux pour les dépôts en Dollars U.S " _
                                                                           + "pour une période de " + strPeriod + " tel que publié sur la Page Telerate " _
                                                                           + "3750 à 11h heure de Londres."
               Case "EUR-LIBOR-BBA"
                     objDocument.Bookmarks(nodeName).Range.Text = "EUR-LIBOR-BBA " + strPeriod + ", soit le taux pour les dépôts en euros pour une " _
                                                                           + "période de " + strPeriod + " tel que publié sur la Page Telerate 3750 à 11h " _
                                                                           + "heure de Londres."
               Case "SEK-STIBOR-SIDE"
                     objDocument.Bookmarks(nodeName).Range.Text = "SEK-STIBOR-SIDE " + strPeriod + ", soit le taux pour les dépôts en Couronnes " _
                                                                           + "Suédoises pour une période de " + strPeriod + " tel que publié sur l'Ecran " _
                                                                           + "Reuters SIDE sous la mention ""FIXINGS"" à 11h heure de Stockholm."
               Case Else
                    objDocument.Bookmarks(nodeName).Range.Text = "N/A"
        End Select
    ElseIf (objDocument.Bookmarks(nodeName) = "olfReset") Then
        Select Case TextValue
               Case "EUR-EURIBOR-Telerate"
                     objDocument.Bookmarks(nodeName).Range.Text = "EUR-EURIBOR-Telerate " + strPeriod2 + ", soit le taux pour les dépôts " _
                                                                           + "en euros pour une période de " + strPeriod2 + " tel que publié sur la P" _
                                                                           + "age Telerate 248 à 11h heure de Bruxelles."
               Case "CHF-LIBOR-BBA"
                     objDocument.Bookmarks(nodeName).Range.Text = "CHF-LIBOR-BBA " + strPeriod2 + ", soit le taux pour les dépôts en Francs" _
                                                                           + " Suisses pour une période de " + strPeriod2 + " tel que publié sur la Page " _
                                                                           + "Telerate 3750 à 11h heure de Londres."
               Case "GBP-LIBOR-BBA"
                     objDocument.Bookmarks(nodeName).Range.Text = "GBP-LIBOR-BBA " + strPeriod2 + ", soit le taux pour les dépôts en Sterling " _
                                                                           + " pour une période de " + strPeriod2 + " tel que publié sur la Page Telerate " _
                                                                           + "3750 à 11h heure de Londres."
               Case "JPY-LIBOR-BBA"
                     objDocument.Bookmarks(nodeName).Range.Text = "JPY-LIBOR-BBA " + strPeriod2 + ", soit le taux pour les dépôts en Yen pour " _
                                                                           + "une période de " + strPeriod2 + " tel que publié sur la Page Telerate 3750 " _
                                                                           + "à 11h heure de Londres."
               Case "USD-LIBOR-BBA"
                     objDocument.Bookmarks(nodeName).Range.Text = "USD-LIBOR-BBA " + strPeriod2 + ", soit le taux pour les dépôts en Dollars U.S " _
                                                                           + "pour une période de " + strPeriod2 + " tel que publié sur la Page Telerate " _
                                                                           + "3750 à 11h heure de Londres."
               Case "EUR-LIBOR-BBA"
                     objDocument.Bookmarks(nodeName).Range.Text = "EUR-LIBOR-BBA " + strPeriod2 + ", soit le taux pour les dépôts en euros pour une " _
                                                                           + "période de " + strPeriod2 + " tel que publié sur la Page Telerate 3750 à 11h " _
                                                                           + "heure de Londres."
               Case "SEK-STIBOR-SIDE"
                     objDocument.Bookmarks(nodeName).Range.Text = "SEK-STIBOR-SIDE " + strPeriod2 + ", soit le taux pour les dépôts en Couronnes " _
                                                                           + "Suédoises pour une période de " + strPeriod2 + " tel que publié sur l'Ecran " _
                                                                           + "Reuters SIDE sous la mention ""FIXINGS"" à 11h heure de Stockholm."
               Case Else
                    objDocument.Bookmarks(nodeName).Range.Text = "N/A"
        End Select
    ElseIf (objDocument.Bookmarks(nodeName) = "olfPymtConv") Then
            objDocument.Bookmarks(nodeName).Range.Text = TextValue
'            objDocument.Bookmarks("olfPymtConv_1").Range.Text = TextValue
            objDocument.Bookmarks("olfPymtConv_2").Range.Text = TextValue
    ElseIf (objDocument.Bookmarks(nodeName) = "olfFxFlt") Then
            objDocument.Bookmarks(nodeName).Range.Text = "Variables"
            objDocument.Bookmarks("olfFxFlt_1").Range.Text = "Variable"
            objDocument.Bookmarks("olfFxFlt_2").Range.Text = "Variables"
            objDocument.Bookmarks("olfFxFlt_3").Range.Text = "Variables"
    ElseIf (objDocument.Bookmarks(nodeName) = "olfSide") Then
            objDocument.Bookmarks(nodeName).Range.Text = CStr(CptVar)
            objDocument.Bookmarks("olfSide_1").Range.Text = CStr(CptVar)
            objDocument.Bookmarks("olfSide_2").Range.Text = CStr(CptVar)
            objDocument.Bookmarks("olfSide_3").Range.Text = CStr(CptVar)
            objDocument.Bookmarks("olfSide_4").Range.Text = CStr(CptVar)

    ElseIf (objDocument.Bookmarks(nodeName) = "olfMonoPeriod" And TextValue="1") Then
		objDocument.Bookmarks("olfMonoPeriod").Range.Text = ""
    ElseIf (objDocument.Bookmarks(nodeName) = "olfMonoPeriod" And TextValue <> "1") Then
		objDocument.Bookmarks("olfMonoPeriod").Delete
		objDocument.Bookmarks("olfMaturityDate_1").Delete
		objDocument.Bookmarks("olfStartDate_1").Delete

    ElseIf (objDocument.Bookmarks(nodeName) = "olfMaturityDate" And strMonoPeriod = "1") Then
		objDocument.Bookmarks("olfMaturityDate_1").Range.Text = "au " & TextValue	


    ElseIf (objDocument.Bookmarks(nodeName) = "olfStartDate" And intFirstLeg= 0 And strMonoPeriod <> "1") Then
   	 	objDocument.Bookmarks("olfStartDate").Range.Text = "de la Date de Commencement"
    ElseIf (objDocument.Bookmarks(nodeName) = "olfStartDate" And intFirstLeg= 0 And strMonoPeriod = "1") Then
   	 	objDocument.Bookmarks("olfStartDate_1").Range.Text = "De la Date de Commencement"
    ElseIf (objDocument.Bookmarks(nodeName) = "olfStartDate" And intFirstLeg= 1 And strMonoPeriod <> "1") Then
            objDocument.Bookmarks("olfStartDate").Range.Text = "du " & TextValue
    ElseIf (objDocument.Bookmarks(nodeName) = "olfStartDate" And intFirstLeg= 1 And strMonoPeriod = "1") Then
            objDocument.Bookmarks("olfStartDate_1").Range.Text = "Du " & TextValue
    
    ElseIf (UCase(strPricingModel)="EXPERTYS" And objDocument.Bookmarks(nodeName) = "olfConstante2") Then
	objDocument.Bookmarks("olfConstante2").Range.Text = TextValue
      objDocument.Bookmarks("olfConstante2_1").Range.Text = TextValue
      objDocument.Bookmarks("olfConstante2_2").Range.Text = TextValue
   
    ElseIf (UCase(strPricingModel)="EXPERTYS" And objDocument.Bookmarks(nodeName) = "olfIndexTenor1") Then
    	objDocument.Bookmarks("olfIndexTenor1").Range.Text = TextValue
        objDocument.Bookmarks("olfIndexTenor1_1").Range.Text = TextValue
        objDocument.Bookmarks("olfIndexTenor1_2").Range.Text = TextValue
        objDocument.Bookmarks("olfIndexTenor1_3").Range.Text = TextValue
        objDocument.Bookmarks("olfIndexTenor1_4").Range.Text = TextValue
    

    ElseIf (UCase(strPricingModel)="EXPERTYS" And objDocument.Bookmarks(nodeName) = "olfIndexTenor2") Then
        objDocument.Bookmarks("olfIndexTenor2").Range.Text = TextValue
        objDocument.Bookmarks("olfIndexTenor2_1").Range.Text = TextValue
        objDocument.Bookmarks("olfIndexTenor2_2").Range.Text = TextValue
        objDocument.Bookmarks("olfIndexTenor2_3").Range.Text = TextValue
        objDocument.Bookmarks("olfIndexTenor2_4").Range.Text = TextValue

    ElseIf (UCase(strPricingModel)="EXPERTYS" And objDocument.Bookmarks(nodeName) = "olfFmlaIdx") Then
	objDocument.Bookmarks("olfFmlaIdx").Range.Text = TextValue
	objDocument.Bookmarks("olfFmlaIdx_1").Range.Text = TextValue
	objDocument.Bookmarks("olfFmlaIdx_2").Range.Text = TextValue
	objDocument.Bookmarks("olfFmlaIdx_3").Range.Text = TextValue
	objDocument.Bookmarks("olfFmlaIdx_4").Range.Text = TextValue

    	
    ElseIf (UCase(strPricingModel)="EXPERTYS" And objDocument.Bookmarks(nodeName) = "olfFmlaIdx2") Then
    	objDocument.Bookmarks("olfFmlaIdx2").Range.Text = TextValue
    	objDocument.Bookmarks("olfFmlaIdx2_1").Range.Text = TextValue
    	objDocument.Bookmarks("olfFmlaIdx2_2").Range.Text = TextValue
    	objDocument.Bookmarks("olfFmlaIdx2_3").Range.Text = TextValue
    	objDocument.Bookmarks("olfFmlaIdx2_4").Range.Text = TextValue

    ElseIf (UCase(strPricingModel)="EXPERTYS" And objDocument.Bookmarks(nodeName) = "olfIndexTenor2SansY") Then
      objDocument.Bookmarks("olfIndexTenor2SansY").Range.Text = TextValue
      objDocument.Bookmarks("olfIndexTenor2SansY_1").Range.Text = TextValue

    ElseIf (UCase(strPricingModel)="EXPERTYS" And objDocument.Bookmarks(nodeName) = "olfIndexTenorSansY") Then
      objDocument.Bookmarks("olfIndexTenorSansY").Range.Text = TextValue
      objDocument.Bookmarks("olfIndexTenorSansY_1").Range.Text = TextValue
    
    ElseIf (objDocument.Bookmarks(nodeName) = "olfFltSpd" And TextValue = "0,000000") Then
		If (UCase(strAgrtType)= "AFB") Then
			objDocument.Bookmarks("olfFltSpd").Range.Text = "Aucune"
		Else 	
			objDocument.Bookmarks("olfFltSpd").Range.Text = "None"
		End If
    Else
            objDocument.Bookmarks(nodeName).Range.Text = TextValue
    End If

End Sub
'----------------------------------------------------------------------------------------
Sub DOC_PopulateAFB_FIX(ByRef objApp, ByRef objDocument, ByRef NodeName, ByRef TextValue, ByRef CptFix, ByRef strPeriod, ByRef strMonoPeriod, ByRef intFirstLeg)

		    If (objDocument.Bookmarks(nodeName) = "olfPymtConv") Then
 		    	  objDocument.Bookmarks("olfPymtConv").Range.Text = TextValue
		    	  objDocument.Bookmarks("olfPymtConv_2").Range.Text = TextValue
                ElseIf (objDocument.Bookmarks(nodeName) = "olfFxFlt") Then
                    objDocument.Bookmarks(nodeName).Range.Text = "Fixes"
                    objDocument.Bookmarks("olfFxFlt_2").Range.Text = "Fixes"
                    objDocument.Bookmarks("olfFxFlt_3").Range.Text = "Fixes"
                ElseIf (objDocument.Bookmarks(nodeName) = "olfSide") Then
                    objDocument.Bookmarks(nodeName).Range.Text = CStr(CptFix)
                    objDocument.Bookmarks("olfSide_1").Range.Text = CStr(CptFix)
                    objDocument.Bookmarks("olfSide_3").Range.Text = CStr(CptFix)
                    objDocument.Bookmarks("olfSide_4").Range.Text = CStr(CptFix)
    		    ElseIf (objDocument.Bookmarks(nodeName) = "olfMonoPeriod" And TextValue="1") Then
			  objDocument.Bookmarks("olfMonoPeriod").Range.Text = ""
    		    ElseIf (objDocument.Bookmarks(nodeName) = "olfMonoPeriod" And TextValue <> "1") Then
			  objDocument.Bookmarks("olfMonoPeriod").Delete
    		    ElseIf (objDocument.Bookmarks(nodeName) = "olfMaturityDate" And strMonoPeriod = "1") Then
			  objDocument.Bookmarks("olfMaturityDate_1").Range.Text = "De la Date de Commencement au " & TextValue	
                ElseIf (objDocument.Bookmarks(nodeName) = "olfRstHolSchd") Then
			  objDocument.Bookmarks("olfRstHolSchd").Range.Text = ""

    		    ElseIf (objDocument.Bookmarks(nodeName) = "olfStartDate" And intFirstLeg= 0) Then
			  objDocument.Bookmarks("olfStartDate").Range.Text = "de la Date de Commencement"
    		    ElseIf (objDocument.Bookmarks(nodeName) = "olfStartDate" And intFirstLeg= 1) Then
			  objDocument.Bookmarks("olfStartDate").Range.Text = "du " & TextValue
    		    Else
                    objDocument.Bookmarks(nodeName).Range.Text = TextValue
                End If
End Sub

'----------------------------------------------------------------------------------------
'////////////////////////////////////////////////////////////////////////////////////////
'Name:          DOC_Adresse(ByRef objApplication, ByRef objDocument)
'
'Description:   Ajout de l'adresse en pied de page et du Logo en entete
'
'Parameters:    objDocument  (IN)   - the Word Document object
'
'Returns:       NONE
'
'Date of Last Revisition:   08/01/2013
'//////////////////////////////////////////////////////////////////////////////////////
Sub DOC_Adresse(ByRef objApplication, ByRef objDocument)
    On Error Resume Next

    Dim i

    sauveviewtype=objDocument.ActiveWindow.View.Type
    strTemplateDir = OLF_GetField("olfTemplateDir")


    If objDocument.Bookmarks.Exists("olfAdresse") = True Then
        objDocument.Bookmarks("olfAdresse").Select
	      objApplication.Selection.InsertFile strTemplateDir & OLF_GetField("olfAdresse")
    End If

    If objDocument.Bookmarks.Exists("olfLogo") = True Then
        objDocument.Bookmarks("olfLogo").Select
	      objApplication.Selection.InsertFile strTemplateDir & OLF_GetField("olfLogo")
    End If

    i=1
    
    While objDocument.Bookmarks.Exists("olfLogo_" & i) = True 
        objDocument.Bookmarks("olfLogo_" & i).Select
	      objApplication.Selection.InsertFile strTemplateDir & OLF_GetField("olfLogo")
        i=i+1
    Wend

    objApplication.ActiveWindow.ActivePane.Close()
    objDocument.ActiveWindow.View.Type=sauveviewtype
    
End Sub

    